<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>fdbc: thread_lib.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>thread_lib.h File Reference</h1><code>#include &lt;event.h&gt;</code><br/>
<code>#include &lt;pthread.h&gt;</code><br/>
<code>#include &lt;unistd.h&gt;</code><br/>
<code>#include &lt;malloc.h&gt;</code><br/>
<code>#include &lt;string.h&gt;</code><br/>
<code>#include &lt;sys/eventfd.h&gt;</code><br/>
<code>#include &quot;<a class="el" href="socket__lib_8h_source.html">socket_lib.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="pg__protocol_8h_source.html">pg_protocol.h</a>&quot;</code><br/>
<div class="dynheader">
Include dependency graph for thread_lib.h:</div>
<div class="dynsection">
<div class="center"><img src="thread__lib_8h__incl.png" border="0" usemap="#thread__lib_8h_map" alt=""/></div>
<map name="thread__lib_8h_map" id="thread__lib_8h">
<area shape="rect" id="node15" href="socket__lib_8h.html" title="socket_lib.h" alt="" coords="824,160,925,189"/><area shape="rect" id="node37" href="pg__protocol_8h.html" title="pg_protocol.h" alt="" coords="487,83,599,112"/><area shape="rect" id="node40" href="command_8h.html" title="command.h" alt="" coords="493,160,592,189"/><area shape="rect" id="node43" href="log__lib_8h.html" title="log_lib.h" alt="" coords="616,160,691,189"/><area shape="rect" id="node50" href="pool__init_8h.html" title="./hashtable/pool_init.h" alt="" coords="371,315,536,344"/><area shape="rect" id="node66" href="pool__worker_8h.html" title="./hashtable/pool_worker.h" alt="" coords="155,160,344,189"/><area shape="rect" id="node52" href="pool__struct_8h.html" title="pool_struct.h" alt="" coords="289,392,399,421"/><area shape="rect" id="node63" href="lookupa_8h.html" title="lookupa.h" alt="" coords="179,469,261,499"/><area shape="rect" id="node69" href="hashtab_8h.html" title="hashtab.h" alt="" coords="256,237,344,267"/></map>
</div>
<div class="dynheader">
This graph shows which files directly or indirectly include this file:</div>
<div class="dynsection">
<div class="center"><img src="thread__lib_8h__dep__incl.png" border="0" usemap="#thread__lib_8hdep_map" alt=""/></div>
<map name="thread__lib_8hdep_map" id="thread__lib_8hdep">
<area shape="rect" id="node3" href="action__lib_8h.html" title="action_lib.h" alt="" coords="44,83,140,112"/><area shape="rect" id="node7" href="strawberry_8c.html" title="strawberry.c" alt="" coords="125,160,229,189"/><area shape="rect" id="node10" href="thread__lib_8c.html" title="thread_lib.c" alt="" coords="215,83,313,112"/><area shape="rect" id="node5" href="action__lib_8c.html" title="action_lib.c" alt="" coords="5,160,101,189"/></map>
</div>

<p><a href="thread__lib_8h_source.html">Go to the source code of this file.</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Data Structures</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structLIBEVENT__TOKEN__THREAD.html">LIBEVENT_TOKEN_THREAD</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structLIBEVENT__WORK__THREAD.html">LIBEVENT_WORK_THREAD</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structfrontend__conn__item.html">FC_ITEM</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structring__queue.html">RQ</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structwork__thread__queue.html">WTQ</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structconn.html">conn</a></td></tr>
<tr><td colspan="2"><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="thread__lib_8h.html#a3684b7c40ee669713097b82b65d756e7">MAX_BACKEND_SESSION</a>&nbsp;&nbsp;&nbsp;128</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="thread__lib_8h.html#ad8d7464e26373fb9d732a078bf81ff08">ERROR_BREAK</a>(client_sfd, send_val, send_val_len, type_val)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="thread__lib_8h.html#a7946a9cf686513f982ebdba6697289be">FIND_RQ</a>(cq, stat)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="thread__lib_8h.html#a470a8330db86864e375e72ffd11a5e35">FIND_WTQ</a>(cq, stat)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="thread__lib_8h.html#aed01721d9fdcbe0a649a2c3cc90058e5">FIND_WTQPID</a>(cq, stat)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="thread__lib_8h.html#a6b501f7f139a4fb9661663e39d02e59f">FIND_Q</a>(type, cq, table, stat)</td></tr>
<tr><td colspan="2"><h2>Enumerations</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">enum &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="thread__lib_8h.html#a2399e7523313bafdd7403991740403d9">RING_JOB_STATE</a> { <a class="el" href="thread__lib_8h.html#a2399e7523313bafdd7403991740403d9a65651a8b04e1614da6d09d955c0e3cad">JOB_FREE</a> = 0, 
<a class="el" href="thread__lib_8h.html#a2399e7523313bafdd7403991740403d9aa7f0b1894da53345d3b3083342d1b4a9">JOB_HAS</a>, 
<a class="el" href="thread__lib_8h.html#a2399e7523313bafdd7403991740403d9a9e2f14f5275acf60a473ffb65e05518b">JOB_WORKING</a>
 }</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">enum &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="thread__lib_8h.html#a3a97eb94bafe8d0c241194c797baaa86">NOTIFY_TOKEN_STATE</a> { <a class="el" href="thread__lib_8h.html#a3a97eb94bafe8d0c241194c797baaa86a62bdc3f2c5393dadc42e869a57846011">NT_FREE</a> = 0, 
<a class="el" href="thread__lib_8h.html#a3a97eb94bafe8d0c241194c797baaa86af1922c888968467fe6fa7583c25ae6d3">NT_HAS</a>, 
<a class="el" href="thread__lib_8h.html#a3a97eb94bafe8d0c241194c797baaa86ae781112538fb9acbce4b8ef5df51a5cd">NT_WORKING</a>
 }</td></tr>
<tr><td colspan="2"><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="thread__lib_8h.html#a91d70880b8de5d73665d2d9a7e46cd72">work_thread_init</a> (int nthreads)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="thread__lib_8h.html#abca92f29174fa6b30f9b90458ffb5982">setup_thread</a> (<a class="el" href="structLIBEVENT__WORK__THREAD.html">LIBEVENT_WORK_THREAD</a> *me)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="thread__lib_8h.html#aa9aef0426afa41186b20a5b005083261">create_worker</a> (void *(*func)(void *), void *arg)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="thread__lib_8h.html#a871abe96b184b7892ad67884fb5241b2">worker_libevent</a> (void *arg)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="thread__lib_8h.html#ae1cbb978768e1e410de39dd9adf3ce2e">libevent_work_thread</a> (int fd, short ev, void *arg)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="thread__lib_8h.html#a3de5c4c46593aca56c44b3482d3f83bf">token_thread_init</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="thread__lib_8h.html#aa386ef0ef688eeeaccbc7d36dba660e3">setup_token</a> (void *(*func)(void *), void *arg)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="thread__lib_8h.html#a21be82a7539e180dc095cde37e71185d">main_token_thread</a> (void *arg)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="thread__lib_8h.html#a3fbea3c610df1ca3573dbeba2a6bc828">libevent_token_thread</a> (int fd, short ev, void *arg)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">RQ *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="thread__lib_8h.html#a31d29aa3804d558953b53019284312fe">rq_item_init</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="thread__lib_8h.html#a4cb09e57c69a74ac0a5e748e022957db">rq_init</a> (int numbers)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="thread__lib_8h.html#a43b9e6b3d8f5ccd03ea395501d077839">rq_push</a> (int client_fd)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">RQ *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="thread__lib_8h.html#a27f32dd63f1b359c3f46c70afb2c053c">rq_pop</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="thread__lib_8h.html#a10090ea1a76781ea36d76ed9eebdd29c">rq_free</a> (RQ *child)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">WTQ *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="thread__lib_8h.html#a0a17a3b840f2ceccda116520d3652196">wtq_init</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="thread__lib_8h.html#a48f85459e8ab18639355dc642da2a4b7">wtq_push</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">WTQ *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="thread__lib_8h.html#a4b162ad8cc7e6ec222a4221629064f93">wtq_pop</a> ()</td></tr>
<tr><td colspan="2"><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="structconn.html">conn</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="thread__lib_8h.html#ae7d6617bd5b26756981768606da7d93e">conns</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">RQ *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="thread__lib_8h.html#a053d64819b2af3c392e75d1462777e85">rq_queue_head</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">RQ *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="thread__lib_8h.html#adff01cf5810f3295f7a070fa9d206304">rq_queue_tail</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">WTQ *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="thread__lib_8h.html#adb6be63082ac21a9a69b84d7458f3f09">wtq_queue_head</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">WTQ *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="thread__lib_8h.html#ade4b8482543f6f5e743df14dbe4942df">wtq_queue_tail</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct event_base *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="thread__lib_8h.html#ab2007460e3f06398c4264137c1a06075">main_base</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="structLIBEVENT__TOKEN__THREAD.html">LIBEVENT_TOKEN_THREAD</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="thread__lib_8h.html#a0a76fcbcffd39af8a2424449ad11c84b">token_thread</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="thread__lib_8h.html#a3a97eb94bafe8d0c241194c797baaa86">NOTIFY_TOKEN_STATE</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="thread__lib_8h.html#a3fee839a6d9eee1090fa3987088be641">notify_token_thread</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="structLIBEVENT__WORK__THREAD.html">LIBEVENT_WORK_THREAD</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="thread__lib_8h.html#a68b90dc047052c139e630b9d98632136">work_threads</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">pthread_mutex_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="thread__lib_8h.html#a8daa1262096450d589b1b7f0a65d5768">init_work_lock</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">pthread_cond_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="thread__lib_8h.html#a02f4081f9071171d0e5e0f3bf1201b6e">init_work_cond</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="thread__lib_8h.html#a09c2d324fd63097f9021d920f3af2363">token_efd</a></td></tr>
</table>
<hr/><h2>Define Documentation</h2>
<a class="anchor" id="ad8d7464e26373fb9d732a078bf81ff08"></a><!-- doxytag: member="thread_lib.h::ERROR_BREAK" ref="ad8d7464e26373fb9d732a078bf81ff08" args="(client_sfd, send_val, send_val_len, type_val)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define ERROR_BREAK</td>
          <td>(</td>
          <td class="paramtype">client_sfd, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">send_val, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">send_val_len, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type_val&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<b>Value:</b><div class="fragment"><pre class="fragment"><span class="keywordflow">do</span> {    \
    (type_val) = 0;                                                \
    <a class="code" href="pg__protocol_8c.html#a6eb5cf1f4f48facc6b554a4eda147a6a">Socket_Send</a>((client_sfd), (send_val), (send_val_len)); \
} <span class="keywordflow">while</span> (0)
</pre></div>
<p>Definition at line <a class="el" href="thread__lib_8h_source.html#l00024">24</a> of file <a class="el" href="thread__lib_8h_source.html">thread_lib.h</a>.</p>

</div>
</div>
<a class="anchor" id="a6b501f7f139a4fb9661663e39d02e59f"></a><!-- doxytag: member="thread_lib.h::FIND_Q" ref="a6b501f7f139a4fb9661663e39d02e59f" args="(type, cq, table, stat)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define FIND_Q</td>
          <td>(</td>
          <td class="paramtype">type, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">cq, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">table, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">stat&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<b>Value:</b><div class="fragment"><pre class="fragment"><span class="keywordflow">do</span>{\
    type *rq_head = (cq);             \
    <span class="keywordflow">do</span>{                             \
        <span class="keywordflow">if</span>(rq_head-&gt;table==(stat)) <span class="keywordflow">break</span>; \
        rq_head = rq_head-&gt;next;            \
    }<span class="keywordflow">while</span>(rq_head!=(cq));                  \
    (cq) = rq_head;                       \
}<span class="keywordflow">while</span>(0)
</pre></div>
<p>Definition at line <a class="el" href="thread__lib_8h_source.html#l00041">41</a> of file <a class="el" href="thread__lib_8h_source.html">thread_lib.h</a>.</p>

</div>
</div>
<a class="anchor" id="a7946a9cf686513f982ebdba6697289be"></a><!-- doxytag: member="thread_lib.h::FIND_RQ" ref="a7946a9cf686513f982ebdba6697289be" args="(cq, stat)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define FIND_RQ</td>
          <td>(</td>
          <td class="paramtype">cq, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">stat&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<b>Value:</b><div class="fragment"><pre class="fragment"><span class="keywordflow">do</span>{\
    <a class="code" href="thread__lib_8h.html#a6b501f7f139a4fb9661663e39d02e59f">FIND_Q</a>(RQ, cq, isjob, stat); \
}<span class="keywordflow">while</span>(0)
</pre></div>
<p>Definition at line <a class="el" href="thread__lib_8h_source.html#l00029">29</a> of file <a class="el" href="thread__lib_8h_source.html">thread_lib.h</a>.</p>

<p>Referenced by <a class="el" href="thread__lib_8c_source.html#l00394">rq_pop()</a>, and <a class="el" href="thread__lib_8c_source.html#l00377">rq_push()</a>.</p>

</div>
</div>
<a class="anchor" id="a470a8330db86864e375e72ffd11a5e35"></a><!-- doxytag: member="thread_lib.h::FIND_WTQ" ref="a470a8330db86864e375e72ffd11a5e35" args="(cq, stat)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define FIND_WTQ</td>
          <td>(</td>
          <td class="paramtype">cq, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">stat&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<b>Value:</b><div class="fragment"><pre class="fragment"><span class="keywordflow">do</span>{\
    <a class="code" href="thread__lib_8h.html#a6b501f7f139a4fb9661663e39d02e59f">FIND_Q</a>(WTQ, cq, isjob, stat); \
}<span class="keywordflow">while</span>(0)
</pre></div>
<p>Definition at line <a class="el" href="thread__lib_8h_source.html#l00033">33</a> of file <a class="el" href="thread__lib_8h_source.html">thread_lib.h</a>.</p>

<p>Referenced by <a class="el" href="thread__lib_8c_source.html#l00275">libevent_token_thread()</a>.</p>

</div>
</div>
<a class="anchor" id="aed01721d9fdcbe0a649a2c3cc90058e5"></a><!-- doxytag: member="thread_lib.h::FIND_WTQPID" ref="aed01721d9fdcbe0a649a2c3cc90058e5" args="(cq, stat)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define FIND_WTQPID</td>
          <td>(</td>
          <td class="paramtype">cq, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">stat&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<b>Value:</b><div class="fragment"><pre class="fragment"><span class="keywordflow">do</span>{\
    <a class="code" href="thread__lib_8h.html#a6b501f7f139a4fb9661663e39d02e59f">FIND_Q</a>(WTQ, cq, pid, stat); \
}<span class="keywordflow">while</span>(0)
</pre></div>
<p>Definition at line <a class="el" href="thread__lib_8h_source.html#l00037">37</a> of file <a class="el" href="thread__lib_8h_source.html">thread_lib.h</a>.</p>

<p>Referenced by <a class="el" href="thread__lib_8c_source.html#l00020">libevent_work_thread()</a>.</p>

</div>
</div>
<a class="anchor" id="a3684b7c40ee669713097b82b65d756e7"></a><!-- doxytag: member="thread_lib.h::MAX_BACKEND_SESSION" ref="a3684b7c40ee669713097b82b65d756e7" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define MAX_BACKEND_SESSION&nbsp;&nbsp;&nbsp;128</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="thread__lib_8h_source.html#l00022">22</a> of file <a class="el" href="thread__lib_8h_source.html">thread_lib.h</a>.</p>

</div>
</div>
<hr/><h2>Enumeration Type Documentation</h2>
<a class="anchor" id="a3a97eb94bafe8d0c241194c797baaa86"></a><!-- doxytag: member="thread_lib.h::NOTIFY_TOKEN_STATE" ref="a3a97eb94bafe8d0c241194c797baaa86" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="thread__lib_8h.html#a3a97eb94bafe8d0c241194c797baaa86">NOTIFY_TOKEN_STATE</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<dl><dt><b>Enumerator: </b></dt><dd><table border="0" cellspacing="2" cellpadding="0">
<tr><td valign="top"><em><a class="anchor" id="a3a97eb94bafe8d0c241194c797baaa86a62bdc3f2c5393dadc42e869a57846011"></a><!-- doxytag: member="NT_FREE" ref="a3a97eb94bafe8d0c241194c797baaa86a62bdc3f2c5393dadc42e869a57846011" args="" -->NT_FREE</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a3a97eb94bafe8d0c241194c797baaa86af1922c888968467fe6fa7583c25ae6d3"></a><!-- doxytag: member="NT_HAS" ref="a3a97eb94bafe8d0c241194c797baaa86af1922c888968467fe6fa7583c25ae6d3" args="" -->NT_HAS</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a3a97eb94bafe8d0c241194c797baaa86ae781112538fb9acbce4b8ef5df51a5cd"></a><!-- doxytag: member="NT_WORKING" ref="a3a97eb94bafe8d0c241194c797baaa86ae781112538fb9acbce4b8ef5df51a5cd" args="" -->NT_WORKING</em>&nbsp;</td><td>
</td></tr>
</table>
</dd>
</dl>

<p>Definition at line <a class="el" href="thread__lib_8h_source.html#l00057">57</a> of file <a class="el" href="thread__lib_8h_source.html">thread_lib.h</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00057"></a>00057              {
<a name="l00058"></a>00058     <a class="code" href="thread__lib_8h.html#a3a97eb94bafe8d0c241194c797baaa86a62bdc3f2c5393dadc42e869a57846011">NT_FREE</a>=0,  <span class="comment">/* default 0 ,it&apos;s 1 has a job, 2 working */</span>
<a name="l00059"></a>00059     <a class="code" href="thread__lib_8h.html#a3a97eb94bafe8d0c241194c797baaa86af1922c888968467fe6fa7583c25ae6d3">NT_HAS</a>,
<a name="l00060"></a>00060     <a class="code" href="thread__lib_8h.html#a3a97eb94bafe8d0c241194c797baaa86ae781112538fb9acbce4b8ef5df51a5cd">NT_WORKING</a>
<a name="l00061"></a>00061 } <a class="code" href="thread__lib_8h.html#a3a97eb94bafe8d0c241194c797baaa86">NOTIFY_TOKEN_STATE</a>;
</pre></div></p>

</div>
</div>
<a class="anchor" id="a2399e7523313bafdd7403991740403d9"></a><!-- doxytag: member="thread_lib.h::RING_JOB_STATE" ref="a2399e7523313bafdd7403991740403d9" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="thread__lib_8h.html#a2399e7523313bafdd7403991740403d9">RING_JOB_STATE</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<dl><dt><b>Enumerator: </b></dt><dd><table border="0" cellspacing="2" cellpadding="0">
<tr><td valign="top"><em><a class="anchor" id="a2399e7523313bafdd7403991740403d9a65651a8b04e1614da6d09d955c0e3cad"></a><!-- doxytag: member="JOB_FREE" ref="a2399e7523313bafdd7403991740403d9a65651a8b04e1614da6d09d955c0e3cad" args="" -->JOB_FREE</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a2399e7523313bafdd7403991740403d9aa7f0b1894da53345d3b3083342d1b4a9"></a><!-- doxytag: member="JOB_HAS" ref="a2399e7523313bafdd7403991740403d9aa7f0b1894da53345d3b3083342d1b4a9" args="" -->JOB_HAS</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a2399e7523313bafdd7403991740403d9a9e2f14f5275acf60a473ffb65e05518b"></a><!-- doxytag: member="JOB_WORKING" ref="a2399e7523313bafdd7403991740403d9a9e2f14f5275acf60a473ffb65e05518b" args="" -->JOB_WORKING</em>&nbsp;</td><td>
</td></tr>
</table>
</dd>
</dl>

<p>Definition at line <a class="el" href="thread__lib_8h_source.html#l00051">51</a> of file <a class="el" href="thread__lib_8h_source.html">thread_lib.h</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00051"></a>00051              {
<a name="l00052"></a>00052     <a class="code" href="thread__lib_8h.html#a2399e7523313bafdd7403991740403d9a65651a8b04e1614da6d09d955c0e3cad">JOB_FREE</a>=0,  <span class="comment">/* default 0 ,it&apos;s 1 has a job, 2 working */</span>
<a name="l00053"></a>00053     <a class="code" href="thread__lib_8h.html#a2399e7523313bafdd7403991740403d9aa7f0b1894da53345d3b3083342d1b4a9">JOB_HAS</a>,
<a name="l00054"></a>00054     <a class="code" href="thread__lib_8h.html#a2399e7523313bafdd7403991740403d9a9e2f14f5275acf60a473ffb65e05518b">JOB_WORKING</a>
<a name="l00055"></a>00055 } <a class="code" href="thread__lib_8h.html#a2399e7523313bafdd7403991740403d9">RING_JOB_STATE</a>;
</pre></div></p>

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="aa9aef0426afa41186b20a5b005083261"></a><!-- doxytag: member="thread_lib.h::create_worker" ref="aa9aef0426afa41186b20a5b005083261" args="(void *(*func)(void *), void *arg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void create_worker </td>
          <td>(</td>
          <td class="paramtype">void *(*)(void *)&nbsp;</td>
          <td class="paramname"> <em>func</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>arg</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="thread__lib_8c_source.html#l00186">186</a> of file <a class="el" href="thread__lib_8c_source.html">thread_lib.c</a>.</p>

<p>References <a class="el" href="log__lib_8c_source.html#l00011">d_log()</a>.</p>

<p>Referenced by <a class="el" href="thread__lib_8c_source.html#l00132">work_thread_init()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00186"></a>00186                                                      {
<a name="l00187"></a>00187     pthread_t       thread;
<a name="l00188"></a>00188     pthread_attr_t  attr;
<a name="l00189"></a>00189     <span class="keywordtype">int</span> ret;
<a name="l00190"></a>00190     pthread_attr_init(&amp;attr);
<a name="l00191"></a>00191     
<a name="l00192"></a>00192     <span class="keywordflow">if</span> ((ret = pthread_create(&amp;thread, &amp;attr, func, arg)) != 0) {
<a name="l00193"></a>00193         <a class="code" href="log__lib_8c.html#a2b52cdbe46ce30c842d4ab36ca9fe052">d_log</a>(<span class="stringliteral">&quot;Can&apos;t create thread&quot;</span>);
<a name="l00194"></a>00194         printf(<span class="stringliteral">&quot;here---\n&quot;</span>);
<a name="l00195"></a>00195         exit(1);
<a name="l00196"></a>00196     }
<a name="l00197"></a>00197 }
</pre></div></p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dynsection">
<div class="center"><img src="thread__lib_8h_aa9aef0426afa41186b20a5b005083261_cgraph.png" border="0" usemap="#thread__lib_8h_aa9aef0426afa41186b20a5b005083261_cgraph_map" alt=""></div>
<map name="thread__lib_8h_aa9aef0426afa41186b20a5b005083261_cgraph_map" id="thread__lib_8h_aa9aef0426afa41186b20a5b005083261_cgraph">
<area shape="rect" id="node3" href="log__lib_8c.html#a2b52cdbe46ce30c842d4ab36ca9fe052" title="d_log" alt="" coords="173,5,229,35"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dynsection">
<div class="center"><img src="thread__lib_8h_aa9aef0426afa41186b20a5b005083261_icgraph.png" border="0" usemap="#thread__lib_8h_aa9aef0426afa41186b20a5b005083261_icgraph_map" alt=""></div>
<map name="thread__lib_8h_aa9aef0426afa41186b20a5b005083261_icgraph_map" id="thread__lib_8h_aa9aef0426afa41186b20a5b005083261_icgraph">
<area shape="rect" id="node3" href="thread__lib_8h.html#a91d70880b8de5d73665d2d9a7e46cd72" title="work_thread_init" alt="" coords="173,5,307,35"/><area shape="rect" id="node5" href="strawberry_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title="main" alt="" coords="356,5,409,35"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a3fbea3c610df1ca3573dbeba2a6bc828"></a><!-- doxytag: member="thread_lib.h::libevent_token_thread" ref="a3fbea3c610df1ca3573dbeba2a6bc828" args="(int fd, short ev, void *arg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void libevent_token_thread </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>fd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">short&nbsp;</td>
          <td class="paramname"> <em>ev</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>arg</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="thread__lib_8c_source.html#l00275">275</a> of file <a class="el" href="thread__lib_8c_source.html">thread_lib.c</a>.</p>

<p>References <a class="el" href="thread__lib_8h_source.html#l00033">FIND_WTQ</a>, <a class="el" href="thread__lib_8h_source.html#l00052">JOB_FREE</a>, <a class="el" href="thread__lib_8h_source.html#l00053">JOB_HAS</a>, <a class="el" href="thread__lib_8h_source.html#l00054">JOB_WORKING</a>, <a class="el" href="thread__lib_8h_source.html#l00079">LIBEVENT_WORK_THREAD::no</a>, <a class="el" href="thread__lib_8h_source.html#l00127">notify_token_thread</a>, <a class="el" href="thread__lib_8h_source.html#l00078">LIBEVENT_WORK_THREAD::notify_write_fd</a>, <a class="el" href="thread__lib_8h_source.html#l00058">NT_FREE</a>, <a class="el" href="thread__lib_8h_source.html#l00060">NT_WORKING</a>, <a class="el" href="thread__lib_8c_source.html#l00394">rq_pop()</a>, <a class="el" href="thread__lib_8h_source.html#l00135">token_efd</a>, <a class="el" href="thread__lib_8h_source.html#l00130">work_threads</a>, and <a class="el" href="thread__lib_8h_source.html#l00122">wtq_queue_tail</a>.</p>

<p>Referenced by <a class="el" href="thread__lib_8c_source.html#l00235">token_thread_init()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00275"></a>00275                                                        {
<a name="l00276"></a>00276     uint64_t u;
<a name="l00277"></a>00277     ssize_t s;
<a name="l00278"></a>00278 
<a name="l00279"></a>00279     s = read(<a class="code" href="thread__lib_8h.html#a09c2d324fd63097f9021d920f3af2363">token_efd</a>, &amp;u, <span class="keyword">sizeof</span>(uint64_t));
<a name="l00280"></a>00280     <span class="keywordflow">if</span> (s != <span class="keyword">sizeof</span>(uint64_t)){
<a name="l00281"></a>00281         printf(<span class="stringliteral">&quot;s is error\n&quot;</span>);
<a name="l00282"></a>00282     }
<a name="l00283"></a>00283 
<a name="l00284"></a>00284     <a class="code" href="thread__lib_8h.html#a3fee839a6d9eee1090fa3987088be641">notify_token_thread</a> = <a class="code" href="thread__lib_8h.html#a3a97eb94bafe8d0c241194c797baaa86ae781112538fb9acbce4b8ef5df51a5cd">NT_WORKING</a>;
<a name="l00285"></a>00285     <span class="keywordflow">do</span>{
<a name="l00286"></a>00286         RQ *rq_item = <a class="code" href="thread__lib_8c.html#a27f32dd63f1b359c3f46c70afb2c053c">rq_pop</a>();
<a name="l00287"></a>00287         <span class="keywordflow">if</span>(rq_item == NULL) <span class="keywordflow">break</span>;
<a name="l00288"></a>00288         <span class="keywordflow">if</span>(rq_item-&gt;isjob == <a class="code" href="thread__lib_8h.html#a2399e7523313bafdd7403991740403d9aa7f0b1894da53345d3b3083342d1b4a9">JOB_HAS</a>) {
<a name="l00289"></a>00289             
<a name="l00290"></a>00290             WTQ *work_child = <a class="code" href="thread__lib_8h.html#ade4b8482543f6f5e743df14dbe4942df">wtq_queue_tail</a>;
<a name="l00291"></a>00291             
<a name="l00292"></a>00292             <a class="code" href="thread__lib_8h.html#a470a8330db86864e375e72ffd11a5e35">FIND_WTQ</a>(work_child, <a class="code" href="thread__lib_8h.html#a2399e7523313bafdd7403991740403d9a65651a8b04e1614da6d09d955c0e3cad">JOB_FREE</a>);
<a name="l00293"></a>00293 
<a name="l00294"></a>00294             <span class="keywordflow">if</span>(work_child-&gt;isjob == <a class="code" href="thread__lib_8h.html#a2399e7523313bafdd7403991740403d9a65651a8b04e1614da6d09d955c0e3cad">JOB_FREE</a>){
<a name="l00295"></a>00295 
<a name="l00296"></a>00296                 rq_item-&gt;isjob = <a class="code" href="thread__lib_8h.html#a2399e7523313bafdd7403991740403d9a9e2f14f5275acf60a473ffb65e05518b">JOB_WORKING</a>;
<a name="l00297"></a>00297                 work_child-&gt;rq_item = rq_item;
<a name="l00298"></a>00298                 work_child-&gt;isjob = <a class="code" href="thread__lib_8h.html#a2399e7523313bafdd7403991740403d9aa7f0b1894da53345d3b3083342d1b4a9">JOB_HAS</a>;
<a name="l00299"></a>00299 
<a name="l00300"></a>00300                 <a class="code" href="structLIBEVENT__WORK__THREAD.html">LIBEVENT_WORK_THREAD</a> *thread;
<a name="l00301"></a>00301                 thread = <a class="code" href="thread__lib_8h.html#a68b90dc047052c139e630b9d98632136">work_threads</a> + work_child-&gt;<a class="code" href="structLIBEVENT__WORK__THREAD.html#a196206e0ab201e18d79c3878336d7d20">no</a>; 
<a name="l00302"></a>00302 
<a name="l00303"></a>00303                 <span class="keywordflow">if</span>(thread == NULL){
<a name="l00304"></a>00304                     printf(<span class="stringliteral">&quot;thread null \n&quot;</span>);
<a name="l00305"></a>00305                     rq_item-&gt;isjob = <a class="code" href="thread__lib_8h.html#a2399e7523313bafdd7403991740403d9aa7f0b1894da53345d3b3083342d1b4a9">JOB_HAS</a>;
<a name="l00306"></a>00306                     work_child-&gt;isjob = <a class="code" href="thread__lib_8h.html#a2399e7523313bafdd7403991740403d9a65651a8b04e1614da6d09d955c0e3cad">JOB_FREE</a>;
<a name="l00307"></a>00307                     <span class="keywordflow">break</span>;
<a name="l00308"></a>00308                 }
<a name="l00309"></a>00309 
<a name="l00310"></a>00310                 <span class="keywordflow">if</span>(write(thread-&gt;<a class="code" href="structLIBEVENT__WORK__THREAD.html#a864eecd6f2d9130d3a149c882899be51">notify_write_fd</a>, <span class="stringliteral">&quot;&quot;</span>, 1) != 1){
<a name="l00311"></a>00311                     printf(<span class="stringliteral">&quot;write thread error\n&quot;</span>);
<a name="l00312"></a>00312                 }
<a name="l00313"></a>00313             }
<a name="l00314"></a>00314         }
<a name="l00315"></a>00315         <span class="keywordflow">else</span>{
<a name="l00316"></a>00316             printf(<span class="stringliteral">&quot;break\n&quot;</span>);
<a name="l00317"></a>00317             <span class="keywordflow">break</span>;
<a name="l00318"></a>00318         }
<a name="l00319"></a>00319     }<span class="keywordflow">while</span>(1);
<a name="l00320"></a>00320 
<a name="l00321"></a>00321     <a class="code" href="thread__lib_8h.html#a3fee839a6d9eee1090fa3987088be641">notify_token_thread</a> = <a class="code" href="thread__lib_8h.html#a3a97eb94bafe8d0c241194c797baaa86a62bdc3f2c5393dadc42e869a57846011">NT_FREE</a>;
<a name="l00322"></a>00322 }
</pre></div></p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dynsection">
<div class="center"><img src="thread__lib_8h_a3fbea3c610df1ca3573dbeba2a6bc828_cgraph.png" border="0" usemap="#thread__lib_8h_a3fbea3c610df1ca3573dbeba2a6bc828_cgraph_map" alt=""></div>
<map name="thread__lib_8h_a3fbea3c610df1ca3573dbeba2a6bc828_cgraph_map" id="thread__lib_8h_a3fbea3c610df1ca3573dbeba2a6bc828_cgraph">
<area shape="rect" id="node3" href="thread__lib_8c.html#a27f32dd63f1b359c3f46c70afb2c053c" title="rq_pop" alt="" coords="229,5,296,35"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dynsection">
<div class="center"><img src="thread__lib_8h_a3fbea3c610df1ca3573dbeba2a6bc828_icgraph.png" border="0" usemap="#thread__lib_8h_a3fbea3c610df1ca3573dbeba2a6bc828_icgraph_map" alt=""></div>
<map name="thread__lib_8h_a3fbea3c610df1ca3573dbeba2a6bc828_icgraph_map" id="thread__lib_8h_a3fbea3c610df1ca3573dbeba2a6bc828_icgraph">
<area shape="rect" id="node3" href="thread__lib_8h.html#a3de5c4c46593aca56c44b3482d3f83bf" title="token_thread_init" alt="" coords="229,5,371,35"/><area shape="rect" id="node5" href="strawberry_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title="main" alt="" coords="420,5,473,35"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ae1cbb978768e1e410de39dd9adf3ce2e"></a><!-- doxytag: member="thread_lib.h::libevent_work_thread" ref="ae1cbb978768e1e410de39dd9adf3ce2e" args="(int fd, short ev, void *arg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void libevent_work_thread </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>fd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">short&nbsp;</td>
          <td class="paramname"> <em>ev</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>arg</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="thread__lib_8c_source.html#l00020">20</a> of file <a class="el" href="thread__lib_8c_source.html">thread_lib.c</a>.</p>

<p>References <a class="el" href="pg__protocol_8c_source.html#l00135">AuthPG()</a>, <a class="el" href="pg__protocol_8h_source.html#l00071">SESSION_SLOTS::backend_fd</a>, <a class="el" href="socket__lib_8c_source.html#l00222">Client_Init()</a>, <a class="el" href="conf__lib_8c_source.html#l00070">conf_get()</a>, <a class="el" href="log__lib_8c_source.html#l00011">d_log()</a>, <a class="el" href="thread__lib_8h_source.html#l00037">FIND_WTQPID</a>, <a class="el" href="thread__lib_8h_source.html#l00052">JOB_FREE</a>, <a class="el" href="thread__lib_8h_source.html#l00053">JOB_HAS</a>, <a class="el" href="thread__lib_8h_source.html#l00054">JOB_WORKING</a>, <a class="el" href="thread__lib_8h_source.html#l00127">notify_token_thread</a>, <a class="el" href="thread__lib_8h_source.html#l00058">NT_FREE</a>, <a class="el" href="pg__protocol_8c_source.html#l00025">PGStartupPacket3()</a>, <a class="el" href="pg__protocol_8c_source.html#l00070">resolve_slot()</a>, <a class="el" href="pg__protocol_8c.html#a6eb5cf1f4f48facc6b554a4eda147a6a">Socket_Send()</a>, <a class="el" href="thread__lib_8h_source.html#l00074">LIBEVENT_WORK_THREAD::thread_id</a>, <a class="el" href="thread__lib_8h_source.html#l00135">token_efd</a>, and <a class="el" href="thread__lib_8h_source.html#l00122">wtq_queue_tail</a>.</p>

<p>Referenced by <a class="el" href="thread__lib_8c_source.html#l00168">setup_thread()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00020"></a>00020                                                       {
<a name="l00021"></a>00021     <a class="code" href="structLIBEVENT__WORK__THREAD.html">LIBEVENT_WORK_THREAD</a> *me =(<a class="code" href="structLIBEVENT__WORK__THREAD.html">LIBEVENT_WORK_THREAD</a> *)arg;
<a name="l00022"></a>00022     <span class="keywordtype">char</span> buf[1], *pv_buf;
<a name="l00023"></a>00023     <span class="keywordtype">int</span> ffd;
<a name="l00024"></a>00024     WTQ *work_child; 
<a name="l00025"></a>00025     <a class="code" href="structSESSION__SLOTS.html">SESSION_SLOTS</a> *slot;
<a name="l00026"></a>00026     <span class="keywordtype">int</span> pg_fds, m, pg_len, client_len, pack_len;
<a name="l00027"></a>00027 
<a name="l00028"></a>00028     PACK *start_pack;
<a name="l00029"></a>00029     <a class="code" href="structSESSION__SLOTS.html">SESSION_SLOTS</a> *_slot;
<a name="l00030"></a>00030 
<a name="l00031"></a>00031     <span class="keywordflow">if</span> (read(fd, buf, 1) != 1)
<a name="l00032"></a>00032             <a class="code" href="log__lib_8c.html#a2b52cdbe46ce30c842d4ab36ca9fe052">d_log</a>(<span class="stringliteral">&quot;error Can&apos;t read from libevent pipe&quot;</span>);
<a name="l00033"></a>00033 
<a name="l00034"></a>00034      
<a name="l00035"></a>00035     work_child = <a class="code" href="thread__lib_8h.html#ade4b8482543f6f5e743df14dbe4942df">wtq_queue_tail</a>;
<a name="l00036"></a>00036     <a class="code" href="thread__lib_8h.html#ade4b8482543f6f5e743df14dbe4942df">wtq_queue_tail</a> = <a class="code" href="thread__lib_8h.html#ade4b8482543f6f5e743df14dbe4942df">wtq_queue_tail</a>-&gt;next;
<a name="l00037"></a>00037 
<a name="l00038"></a>00038    <span class="comment">// printf(&quot;thread_id:%llu\n&quot;, me-&gt;thread_id);</span>
<a name="l00039"></a>00039 
<a name="l00040"></a>00040     <a class="code" href="thread__lib_8h.html#aed01721d9fdcbe0a649a2c3cc90058e5">FIND_WTQPID</a>(work_child, me-&gt;<a class="code" href="structLIBEVENT__WORK__THREAD.html#a614409619094fd8c0c6b522c400ffeea">thread_id</a>);
<a name="l00041"></a>00041     <span class="keywordflow">if</span>(work_child-&gt;isjob == <a class="code" href="thread__lib_8h.html#a2399e7523313bafdd7403991740403d9aa7f0b1894da53345d3b3083342d1b4a9">JOB_HAS</a>)
<a name="l00042"></a>00042         work_child-&gt;isjob = <a class="code" href="thread__lib_8h.html#a2399e7523313bafdd7403991740403d9a9e2f14f5275acf60a473ffb65e05518b">JOB_WORKING</a>;
<a name="l00043"></a>00043     <span class="keywordflow">else</span>{
<a name="l00044"></a>00044          <span class="keywordflow">goto</span> err;
<a name="l00045"></a>00045     }
<a name="l00046"></a>00046     <span class="comment">//rq_child = child-&gt;rqchild;</span>
<a name="l00047"></a>00047     <span class="comment">//pg_fds = Client_Init(conf_get(&quot;pg_host&quot;), atoi(conf_get(&quot;pg_port&quot;)));</span>
<a name="l00048"></a>00048     <span class="comment">//cmd = (char *)calloc(1, sizeof(char));</span>
<a name="l00049"></a>00049     
<a name="l00050"></a>00050     ffd = work_child-&gt;rq_item-&gt;frontend-&gt;ffd;
<a name="l00051"></a>00051 
<a name="l00052"></a>00052     start_pack = (PACK *)calloc(1, <span class="keyword">sizeof</span>(PACK));
<a name="l00053"></a>00053     start_pack-&gt;pack = (<span class="keywordtype">char</span> *)calloc(1, <span class="keyword">sizeof</span>(<span class="keywordtype">char</span>));
<a name="l00054"></a>00054     pack_len = <a class="code" href="pg__protocol_8c.html#a8a78b0d7c16cf92ef2502025c1a134c2">PGStartupPacket3</a>(ffd, start_pack);  <span class="comment">/*  1. F -&gt; B */</span>
<a name="l00055"></a>00055     <span class="keywordflow">if</span>(pack_len == -1)<span class="keywordflow">goto</span> ok; 
<a name="l00056"></a>00056 
<a name="l00057"></a>00057     pg_fds = <a class="code" href="socket__lib_8c.html#af47f95cdbc414ea7e9b9ffab1e1ba08d">Client_Init</a>(<a class="code" href="conf__lib_8c.html#aa34b509b14cc5e81b12c856549b62525">conf_get</a>(<span class="stringliteral">&quot;pg_host&quot;</span>), atoi(<a class="code" href="conf__lib_8c.html#aa34b509b14cc5e81b12c856549b62525">conf_get</a>(<span class="stringliteral">&quot;pg_port&quot;</span>)));
<a name="l00058"></a>00058     <span class="keywordflow">if</span>(pg_fds == -1){
<a name="l00059"></a>00059         <span class="keywordflow">if</span>(start_pack-&gt;pack != NULL)free(start_pack-&gt;pack);
<a name="l00060"></a>00060         start_pack-&gt;pack = NULL;
<a name="l00061"></a>00061         <span class="keywordflow">goto</span> bad;
<a name="l00062"></a>00062     }
<a name="l00063"></a>00063     pg_len = <a class="code" href="pg__protocol_8c.html#a6eb5cf1f4f48facc6b554a4eda147a6a">Socket_Send</a>(pg_fds, start_pack-&gt;pack, pack_len);
<a name="l00064"></a>00064 
<a name="l00065"></a>00065 
<a name="l00066"></a>00066     <span class="keywordflow">if</span>(pg_len != pack_len) <span class="keywordflow">goto</span> bad;
<a name="l00067"></a>00067     _slot = <a class="code" href="pg__protocol_8c.html#a17274e5d37fc9e0ce4b530d299072f66">resolve_slot</a>(start_pack-&gt;pack);
<a name="l00068"></a>00068     
<a name="l00069"></a>00069    <span class="keywordflow">if</span>(_slot-&gt;<a class="code" href="structSESSION__SLOTS.html#ac0a7e1ee7bcbc6a025455250eab73e9b">backend_fd</a> == 0){
<a name="l00070"></a>00070        <span class="comment">/*  pg_fds = Client_Init(conf_get(&quot;pg_host&quot;), atoi(conf_get(&quot;pg_port&quot;)));</span>
<a name="l00071"></a>00071 <span class="comment">        if(pg_fds == -1){</span>
<a name="l00072"></a>00072 <span class="comment">            if(start_pack-&gt;pack != NULL)free(start_pack-&gt;pack);</span>
<a name="l00073"></a>00073 <span class="comment">            start_pack-&gt;pack = NULL;</span>
<a name="l00074"></a>00074 <span class="comment">            goto bad;</span>
<a name="l00075"></a>00075 <span class="comment">        }</span>
<a name="l00076"></a>00076 <span class="comment">        pg_len = Socket_Send(pg_fds, start_pack-&gt;pack, pack_len);</span>
<a name="l00077"></a>00077 <span class="comment"></span>
<a name="l00078"></a>00078 <span class="comment">         */</span>
<a name="l00079"></a>00079         <span class="keywordflow">if</span>(pg_len != pack_len) <span class="keywordflow">goto</span> bad;
<a name="l00080"></a>00080         <span class="keywordflow">if</span>(<a class="code" href="pg__protocol_8c.html#a2e80fd727d460b3d797b3ec4b2620f52">AuthPG</a>(pg_fds, ffd, _slot, work_child-&gt;no)==-1){
<a name="l00081"></a>00081             <span class="comment">//printf(&quot;auth error\n&quot;);</span>
<a name="l00082"></a>00082             <span class="comment">//            goto bad;</span>
<a name="l00083"></a>00083             <span class="comment">//                    }else{</span>
<a name="l00084"></a>00084             <span class="comment">//</span>
<a name="l00085"></a>00085             <span class="comment">//                            }</span>
<a name="l00086"></a>00086             <span class="comment">//                                }</span>
<a name="l00087"></a>00087             <span class="comment">//</span>
<a name="l00088"></a>00088             <span class="comment">//                                 </span>
<a name="l00089"></a>00089             <span class="comment">//                    }</span>
<a name="l00090"></a>00090         }<span class="keywordflow">else</span>{
<a name="l00091"></a>00091         }
<a name="l00092"></a>00092     }        
<a name="l00093"></a>00093     
<a name="l00094"></a>00094 
<a name="l00095"></a>00095     work_child-&gt;isjob = <a class="code" href="thread__lib_8h.html#a2399e7523313bafdd7403991740403d9a65651a8b04e1614da6d09d955c0e3cad">JOB_FREE</a>;
<a name="l00096"></a>00096 
<a name="l00097"></a>00097     <span class="comment">//rq_free(rq_child);</span>
<a name="l00098"></a>00098 
<a name="l00099"></a>00099     <span class="comment">//child-&gt;rqchild = NULL;</span>
<a name="l00100"></a>00100       
<a name="l00101"></a>00101     <span class="keywordflow">if</span>(<a class="code" href="thread__lib_8h.html#a3fee839a6d9eee1090fa3987088be641">notify_token_thread</a> == <a class="code" href="thread__lib_8h.html#a3a97eb94bafe8d0c241194c797baaa86a62bdc3f2c5393dadc42e869a57846011">NT_FREE</a>){
<a name="l00102"></a>00102         uint64_t u;
<a name="l00103"></a>00103         ssize_t s;
<a name="l00104"></a>00104         u = 1;
<a name="l00105"></a>00105         s = write(<a class="code" href="thread__lib_8h.html#a09c2d324fd63097f9021d920f3af2363">token_efd</a>, &amp;u , <span class="keyword">sizeof</span>(uint64_t));
<a name="l00106"></a>00106         <span class="keywordflow">if</span>(s != <span class="keyword">sizeof</span>(uint64_t)){
<a name="l00107"></a>00107             printf(<span class="stringliteral">&quot;write error s:%d\n&quot;</span>, s);
<a name="l00108"></a>00108         }
<a name="l00109"></a>00109         <span class="comment">//printf(&quot;token_efd\n&quot;);</span>
<a name="l00110"></a>00110     }
<a name="l00111"></a>00111 
<a name="l00112"></a>00112 
<a name="l00113"></a>00113     ok:
<a name="l00114"></a>00114 
<a name="l00115"></a>00115     bad:
<a name="l00116"></a>00116 
<a name="l00117"></a>00117     err:
<a name="l00118"></a>00118         close(work_child-&gt;rq_item-&gt;frontend-&gt;ffd);
<a name="l00119"></a>00119         work_child-&gt;rq_item-&gt;isjob = <a class="code" href="thread__lib_8h.html#a2399e7523313bafdd7403991740403d9a65651a8b04e1614da6d09d955c0e3cad">JOB_FREE</a>;
<a name="l00120"></a>00120         work_child-&gt;isjob = <a class="code" href="thread__lib_8h.html#a2399e7523313bafdd7403991740403d9a65651a8b04e1614da6d09d955c0e3cad">JOB_FREE</a>;
<a name="l00121"></a>00121         printf(<span class="stringliteral">&quot;end\n&quot;</span>);
<a name="l00122"></a>00122         <span class="comment">//rq_free(rq_child);</span>
<a name="l00123"></a>00123 
<a name="l00124"></a>00124         <span class="comment">//(void)0;</span>
<a name="l00125"></a>00125 
<a name="l00126"></a>00126     <span class="comment">/* clean_sfd:</span>
<a name="l00127"></a>00127 <span class="comment">        if(Socket_Close(rq_child-&gt;client-&gt;cfd) == -1) d_log(&quot;close fd error!\n&quot;);</span>
<a name="l00128"></a>00128 <span class="comment">        rq_child-&gt;isjob = JOB_FREE;     </span>
<a name="l00129"></a>00129 <span class="comment">    */</span>
<a name="l00130"></a>00130 }
</pre></div></p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dynsection">
<div class="center"><img src="thread__lib_8h_ae1cbb978768e1e410de39dd9adf3ce2e_cgraph.png" border="0" usemap="#thread__lib_8h_ae1cbb978768e1e410de39dd9adf3ce2e_cgraph_map" alt=""></div>
<map name="thread__lib_8h_ae1cbb978768e1e410de39dd9adf3ce2e_cgraph_map" id="thread__lib_8h_ae1cbb978768e1e410de39dd9adf3ce2e_cgraph">
<area shape="rect" id="node3" href="pg__protocol_8c.html#a2e80fd727d460b3d797b3ec4b2620f52" title="AuthPG" alt="" coords="259,5,331,35"/><area shape="rect" id="node7" href="socket__lib_8c.html#af47f95cdbc414ea7e9b9ffab1e1ba08d" title="Client_Init" alt="" coords="249,59,340,88"/><area shape="rect" id="node9" href="conf__lib_8c.html#aa34b509b14cc5e81b12c856549b62525" title="conf_get" alt="" coords="253,112,336,141"/><area shape="rect" id="node11" href="log__lib_8c.html#a2b52cdbe46ce30c842d4ab36ca9fe052" title="d_log" alt="" coords="444,164,500,193"/><area shape="rect" id="node13" href="pg__protocol_8c.html#a8a78b0d7c16cf92ef2502025c1a134c2" title="PGStartupPacket3" alt="" coords="221,216,368,245"/><area shape="rect" id="node18" href="pg__protocol_8c.html#a17274e5d37fc9e0ce4b530d299072f66" title="resolve_slot" alt="" coords="244,269,345,299"/><area shape="rect" id="node20" href="pg__protocol_8c.html#a6eb5cf1f4f48facc6b554a4eda147a6a" title="Socket_Send" alt="" coords="240,323,349,352"/><area shape="rect" id="node5" href="pool__worker_8c.html#a543a71476898c79b560429dd6f9bc94b" title="freeHdr" alt="" coords="436,5,508,35"/><area shape="rect" id="node16" href="socket__lib_8c.html#aef7d9a1318d5dd934c3da007601ce730" title="Socket_Read" alt="" coords="417,217,527,247"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dynsection">
<div class="center"><img src="thread__lib_8h_ae1cbb978768e1e410de39dd9adf3ce2e_icgraph.png" border="0" usemap="#thread__lib_8h_ae1cbb978768e1e410de39dd9adf3ce2e_icgraph_map" alt=""></div>
<map name="thread__lib_8h_ae1cbb978768e1e410de39dd9adf3ce2e_icgraph_map" id="thread__lib_8h_ae1cbb978768e1e410de39dd9adf3ce2e_icgraph">
<area shape="rect" id="node3" href="thread__lib_8h.html#abca92f29174fa6b30f9b90458ffb5982" title="setup_thread" alt="" coords="223,5,335,35"/><area shape="rect" id="node5" href="thread__lib_8h.html#a91d70880b8de5d73665d2d9a7e46cd72" title="work_thread_init" alt="" coords="384,5,517,35"/><area shape="rect" id="node7" href="strawberry_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title="main" alt="" coords="567,5,620,35"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a21be82a7539e180dc095cde37e71185d"></a><!-- doxytag: member="thread_lib.h::main_token_thread" ref="a21be82a7539e180dc095cde37e71185d" args="(void *arg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void* main_token_thread </td>
          <td>(</td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>arg</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="thread__lib_8c_source.html#l00270">270</a> of file <a class="el" href="thread__lib_8c_source.html">thread_lib.c</a>.</p>

<p>References <a class="el" href="thread__lib_8h_source.html#l00067">LIBEVENT_TOKEN_THREAD::base</a>.</p>

<p>Referenced by <a class="el" href="thread__lib_8c_source.html#l00235">token_thread_init()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00270"></a>00270                                   {
<a name="l00271"></a>00271     <a class="code" href="structLIBEVENT__TOKEN__THREAD.html">LIBEVENT_TOKEN_THREAD</a> *me = arg;
<a name="l00272"></a>00272     event_base_loop(me-&gt;<a class="code" href="structLIBEVENT__TOKEN__THREAD.html#ab1a154f7530a81e9dd1d63fc6b98a5c7">base</a>, 0);
<a name="l00273"></a>00273 }
</pre></div></p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dynsection">
<div class="center"><img src="thread__lib_8h_a21be82a7539e180dc095cde37e71185d_icgraph.png" border="0" usemap="#thread__lib_8h_a21be82a7539e180dc095cde37e71185d_icgraph_map" alt=""></div>
<map name="thread__lib_8h_a21be82a7539e180dc095cde37e71185d_icgraph_map" id="thread__lib_8h_a21be82a7539e180dc095cde37e71185d_icgraph">
<area shape="rect" id="node3" href="thread__lib_8h.html#a3de5c4c46593aca56c44b3482d3f83bf" title="token_thread_init" alt="" coords="205,5,347,35"/><area shape="rect" id="node5" href="strawberry_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title="main" alt="" coords="396,5,449,35"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a10090ea1a76781ea36d76ed9eebdd29c"></a><!-- doxytag: member="thread_lib.h::rq_free" ref="a10090ea1a76781ea36d76ed9eebdd29c" args="(RQ *child)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void rq_free </td>
          <td>(</td>
          <td class="paramtype">RQ *&nbsp;</td>
          <td class="paramname"> <em>child</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="thread__lib_8c_source.html#l00412">412</a> of file <a class="el" href="thread__lib_8c_source.html">thread_lib.c</a>.</p>

<p>References <a class="el" href="thread__lib_8h_source.html#l00052">JOB_FREE</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00412"></a>00412                        {
<a name="l00413"></a>00413 
<a name="l00414"></a>00414     <span class="keywordflow">if</span>(child != NULL){
<a name="l00415"></a>00415         close(child-&gt;frontend-&gt;ffd);
<a name="l00416"></a>00416         <span class="comment">/*  if(Socket_Close(child-&gt;client-&gt;cfd) == -1) d_log(&quot;close fd error!\n&quot;);*/</span>
<a name="l00417"></a>00417         child-&gt;isjob = <a class="code" href="thread__lib_8h.html#a2399e7523313bafdd7403991740403d9a65651a8b04e1614da6d09d955c0e3cad">JOB_FREE</a>; 
<a name="l00418"></a>00418         <span class="keywordflow">if</span>(child-&gt;frontend != NULL)
<a name="l00419"></a>00419             free(child-&gt;frontend);
<a name="l00420"></a>00420         free(child);
<a name="l00421"></a>00421     }
<a name="l00422"></a>00422 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a4cb09e57c69a74ac0a5e748e022957db"></a><!-- doxytag: member="thread_lib.h::rq_init" ref="a4cb09e57c69a74ac0a5e748e022957db" args="(int numbers)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int rq_init </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>numbers</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="thread__lib_8c_source.html#l00353">353</a> of file <a class="el" href="thread__lib_8c_source.html">thread_lib.c</a>.</p>

<p>References <a class="el" href="thread__lib_8c_source.html#l00329">rq_item_init()</a>, <a class="el" href="thread__lib_8h_source.html#l00118">rq_queue_head</a>, and <a class="el" href="thread__lib_8h_source.html#l00119">rq_queue_tail</a>.</p>

<p>Referenced by <a class="el" href="strawberry_8c_source.html#l00021">main()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00353"></a>00353                         {
<a name="l00354"></a>00354     <span class="keywordtype">int</span> n;
<a name="l00355"></a>00355     RQ *rq_child;
<a name="l00356"></a>00356 
<a name="l00357"></a>00357     <span class="keywordflow">if</span>(numbers &lt; 1) <span class="keywordflow">return</span> -1;
<a name="l00358"></a>00358     
<a name="l00359"></a>00359     <a class="code" href="thread__lib_8h.html#a053d64819b2af3c392e75d1462777e85">rq_queue_head</a> = <a class="code" href="thread__lib_8c.html#a31d29aa3804d558953b53019284312fe">rq_item_init</a>();
<a name="l00360"></a>00360     <a class="code" href="thread__lib_8h.html#adff01cf5810f3295f7a070fa9d206304">rq_queue_tail</a> = <a class="code" href="thread__lib_8h.html#a053d64819b2af3c392e75d1462777e85">rq_queue_head</a>;
<a name="l00361"></a>00361 
<a name="l00362"></a>00362     <span class="keywordflow">for</span>(n=1; n&lt;numbers; n++){
<a name="l00363"></a>00363         rq_child = <a class="code" href="thread__lib_8c.html#a31d29aa3804d558953b53019284312fe">rq_item_init</a>();
<a name="l00364"></a>00364         <a class="code" href="thread__lib_8h.html#a053d64819b2af3c392e75d1462777e85">rq_queue_head</a>-&gt;next = rq_child;
<a name="l00365"></a>00365         <a class="code" href="thread__lib_8h.html#a053d64819b2af3c392e75d1462777e85">rq_queue_head</a> = rq_child;
<a name="l00366"></a>00366     }
<a name="l00367"></a>00367 
<a name="l00368"></a>00368     <a class="code" href="thread__lib_8h.html#a053d64819b2af3c392e75d1462777e85">rq_queue_head</a>-&gt;next = <a class="code" href="thread__lib_8h.html#adff01cf5810f3295f7a070fa9d206304">rq_queue_tail</a>;
<a name="l00369"></a>00369     <a class="code" href="thread__lib_8h.html#a053d64819b2af3c392e75d1462777e85">rq_queue_head</a> = <a class="code" href="thread__lib_8h.html#adff01cf5810f3295f7a070fa9d206304">rq_queue_tail</a>;
<a name="l00370"></a>00370 
<a name="l00371"></a>00371     <span class="keywordflow">return</span> 0;
<a name="l00372"></a>00372 }
</pre></div></p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dynsection">
<div class="center"><img src="thread__lib_8h_a4cb09e57c69a74ac0a5e748e022957db_cgraph.png" border="0" usemap="#thread__lib_8h_a4cb09e57c69a74ac0a5e748e022957db_cgraph_map" alt=""></div>
<map name="thread__lib_8h_a4cb09e57c69a74ac0a5e748e022957db_cgraph_map" id="thread__lib_8h_a4cb09e57c69a74ac0a5e748e022957db_cgraph">
<area shape="rect" id="node3" href="thread__lib_8c.html#a31d29aa3804d558953b53019284312fe" title="rq_item_init" alt="" coords="119,5,220,35"/><area shape="rect" id="node5" href="log__lib_8c.html#a2b52cdbe46ce30c842d4ab36ca9fe052" title="d_log" alt="" coords="269,5,325,35"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dynsection">
<div class="center"><img src="thread__lib_8h_a4cb09e57c69a74ac0a5e748e022957db_icgraph.png" border="0" usemap="#thread__lib_8h_a4cb09e57c69a74ac0a5e748e022957db_icgraph_map" alt=""></div>
<map name="thread__lib_8h_a4cb09e57c69a74ac0a5e748e022957db_icgraph_map" id="thread__lib_8h_a4cb09e57c69a74ac0a5e748e022957db_icgraph">
<area shape="rect" id="node3" href="strawberry_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title="main" alt="" coords="119,5,172,35"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a31d29aa3804d558953b53019284312fe"></a><!-- doxytag: member="thread_lib.h::rq_item_init" ref="a31d29aa3804d558953b53019284312fe" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">RQ* rq_item_init </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="thread__lib_8c_source.html#l00329">329</a> of file <a class="el" href="thread__lib_8c_source.html">thread_lib.c</a>.</p>

<p>References <a class="el" href="log__lib_8c_source.html#l00011">d_log()</a>, and <a class="el" href="thread__lib_8h_source.html#l00052">JOB_FREE</a>.</p>

<p>Referenced by <a class="el" href="thread__lib_8c_source.html#l00353">rq_init()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00329"></a>00329                   {
<a name="l00330"></a>00330     RQ *rq;
<a name="l00331"></a>00331 
<a name="l00332"></a>00332     rq = (RQ *)calloc(1, <span class="keyword">sizeof</span>(RQ));
<a name="l00333"></a>00333     <span class="keywordflow">if</span>(rq == NULL){
<a name="l00334"></a>00334         <a class="code" href="log__lib_8c.html#a2b52cdbe46ce30c842d4ab36ca9fe052">d_log</a>(<span class="stringliteral">&quot;Can&apos;t calloc for RQ&quot;</span>);
<a name="l00335"></a>00335         exit(1);    
<a name="l00336"></a>00336     }   
<a name="l00337"></a>00337 
<a name="l00338"></a>00338     rq-&gt;frontend = (FC_ITEM *)calloc(1, <span class="keyword">sizeof</span>(FC_ITEM));
<a name="l00339"></a>00339     <span class="keywordflow">if</span>(rq-&gt;frontend == NULL){
<a name="l00340"></a>00340         <a class="code" href="log__lib_8c.html#a2b52cdbe46ce30c842d4ab36ca9fe052">d_log</a>(<span class="stringliteral">&quot;Can&apos;t calloc for CC_ITEM&quot;</span>);
<a name="l00341"></a>00341         exit(1);
<a name="l00342"></a>00342     }   
<a name="l00343"></a>00343 
<a name="l00344"></a>00344     rq-&gt;isjob = <a class="code" href="thread__lib_8h.html#a2399e7523313bafdd7403991740403d9a65651a8b04e1614da6d09d955c0e3cad">JOB_FREE</a>;
<a name="l00345"></a>00345     rq-&gt;next = NULL;
<a name="l00346"></a>00346 
<a name="l00347"></a>00347     <span class="keywordflow">return</span> rq; 
<a name="l00348"></a>00348 }
</pre></div></p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dynsection">
<div class="center"><img src="thread__lib_8h_a31d29aa3804d558953b53019284312fe_cgraph.png" border="0" usemap="#thread__lib_8h_a31d29aa3804d558953b53019284312fe_cgraph_map" alt=""></div>
<map name="thread__lib_8h_a31d29aa3804d558953b53019284312fe_cgraph_map" id="thread__lib_8h_a31d29aa3804d558953b53019284312fe_cgraph">
<area shape="rect" id="node3" href="log__lib_8c.html#a2b52cdbe46ce30c842d4ab36ca9fe052" title="d_log" alt="" coords="157,5,213,35"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dynsection">
<div class="center"><img src="thread__lib_8h_a31d29aa3804d558953b53019284312fe_icgraph.png" border="0" usemap="#thread__lib_8h_a31d29aa3804d558953b53019284312fe_icgraph_map" alt=""></div>
<map name="thread__lib_8h_a31d29aa3804d558953b53019284312fe_icgraph_map" id="thread__lib_8h_a31d29aa3804d558953b53019284312fe_icgraph">
<area shape="rect" id="node3" href="thread__lib_8h.html#a4cb09e57c69a74ac0a5e748e022957db" title="rq_init" alt="" coords="159,5,220,35"/><area shape="rect" id="node5" href="strawberry_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title="main" alt="" coords="271,5,324,35"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a27f32dd63f1b359c3f46c70afb2c053c"></a><!-- doxytag: member="thread_lib.h::rq_pop" ref="a27f32dd63f1b359c3f46c70afb2c053c" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">RQ* rq_pop </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="thread__lib_8c_source.html#l00394">394</a> of file <a class="el" href="thread__lib_8c_source.html">thread_lib.c</a>.</p>

<p>References <a class="el" href="thread__lib_8h_source.html#l00029">FIND_RQ</a>, <a class="el" href="thread__lib_8h_source.html#l00053">JOB_HAS</a>, and <a class="el" href="thread__lib_8h_source.html#l00119">rq_queue_tail</a>.</p>

<p>Referenced by <a class="el" href="thread__lib_8c_source.html#l00275">libevent_token_thread()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00394"></a>00394             {
<a name="l00395"></a>00395     RQ *rq_i;
<a name="l00396"></a>00396     
<a name="l00397"></a>00397     <a class="code" href="thread__lib_8h.html#a7946a9cf686513f982ebdba6697289be">FIND_RQ</a>(<a class="code" href="thread__lib_8h.html#adff01cf5810f3295f7a070fa9d206304">rq_queue_tail</a>, <a class="code" href="thread__lib_8h.html#a2399e7523313bafdd7403991740403d9aa7f0b1894da53345d3b3083342d1b4a9">JOB_HAS</a>);
<a name="l00398"></a>00398     
<a name="l00399"></a>00399     <span class="keywordflow">if</span>(<a class="code" href="thread__lib_8h.html#adff01cf5810f3295f7a070fa9d206304">rq_queue_tail</a>-&gt;isjob != <a class="code" href="thread__lib_8h.html#a2399e7523313bafdd7403991740403d9aa7f0b1894da53345d3b3083342d1b4a9">JOB_HAS</a>){
<a name="l00400"></a>00400         <span class="keywordflow">return</span> NULL;
<a name="l00401"></a>00401     }
<a name="l00402"></a>00402     
<a name="l00403"></a>00403     rq_i = <a class="code" href="thread__lib_8h.html#adff01cf5810f3295f7a070fa9d206304">rq_queue_tail</a>;
<a name="l00404"></a>00404     <a class="code" href="thread__lib_8h.html#adff01cf5810f3295f7a070fa9d206304">rq_queue_tail</a> = <a class="code" href="thread__lib_8h.html#adff01cf5810f3295f7a070fa9d206304">rq_queue_tail</a>-&gt;next;
<a name="l00405"></a>00405 
<a name="l00406"></a>00406     <span class="keywordflow">return</span> rq_i; 
<a name="l00407"></a>00407 }
</pre></div></p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dynsection">
<div class="center"><img src="thread__lib_8h_a27f32dd63f1b359c3f46c70afb2c053c_icgraph.png" border="0" usemap="#thread__lib_8h_a27f32dd63f1b359c3f46c70afb2c053c_icgraph_map" alt=""></div>
<map name="thread__lib_8h_a27f32dd63f1b359c3f46c70afb2c053c_icgraph_map" id="thread__lib_8h_a27f32dd63f1b359c3f46c70afb2c053c_icgraph">
<area shape="rect" id="node3" href="thread__lib_8h.html#a3fbea3c610df1ca3573dbeba2a6bc828" title="libevent_token_thread" alt="" coords="121,5,295,35"/><area shape="rect" id="node5" href="thread__lib_8h.html#a3de5c4c46593aca56c44b3482d3f83bf" title="token_thread_init" alt="" coords="344,5,485,35"/><area shape="rect" id="node7" href="strawberry_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title="main" alt="" coords="535,5,588,35"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a43b9e6b3d8f5ccd03ea395501d077839"></a><!-- doxytag: member="thread_lib.h::rq_push" ref="a43b9e6b3d8f5ccd03ea395501d077839" args="(int client_fd)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int rq_push </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>client_fd</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="thread__lib_8c_source.html#l00377">377</a> of file <a class="el" href="thread__lib_8c_source.html">thread_lib.c</a>.</p>

<p>References <a class="el" href="thread__lib_8h_source.html#l00029">FIND_RQ</a>, <a class="el" href="time__lib_8c_source.html#l00064">get_sec()</a>, <a class="el" href="thread__lib_8h_source.html#l00052">JOB_FREE</a>, <a class="el" href="thread__lib_8h_source.html#l00053">JOB_HAS</a>, and <a class="el" href="thread__lib_8h_source.html#l00118">rq_queue_head</a>.</p>

<p>Referenced by <a class="el" href="action__lib_8c_source.html#l00014">on_accept()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00377"></a>00377                           {
<a name="l00378"></a>00378 
<a name="l00379"></a>00379     <a class="code" href="thread__lib_8h.html#a7946a9cf686513f982ebdba6697289be">FIND_RQ</a>(<a class="code" href="thread__lib_8h.html#a053d64819b2af3c392e75d1462777e85">rq_queue_head</a>, <a class="code" href="thread__lib_8h.html#a2399e7523313bafdd7403991740403d9a65651a8b04e1614da6d09d955c0e3cad">JOB_FREE</a>);
<a name="l00380"></a>00380    
<a name="l00381"></a>00381     <span class="keywordflow">if</span>(<a class="code" href="thread__lib_8h.html#a053d64819b2af3c392e75d1462777e85">rq_queue_head</a>-&gt;isjob != <a class="code" href="thread__lib_8h.html#a2399e7523313bafdd7403991740403d9a65651a8b04e1614da6d09d955c0e3cad">JOB_FREE</a>) <span class="keywordflow">return</span> -1;
<a name="l00382"></a>00382 
<a name="l00383"></a>00383     <a class="code" href="thread__lib_8h.html#a053d64819b2af3c392e75d1462777e85">rq_queue_head</a>-&gt;frontend-&gt;ffd = client_fd;
<a name="l00384"></a>00384     <a class="code" href="thread__lib_8h.html#a053d64819b2af3c392e75d1462777e85">rq_queue_head</a>-&gt;frontend-&gt;ctime = <a class="code" href="time__lib_8c.html#a56b3a491c800d7a69fb6a2b20672f6b9">get_sec</a>() ;
<a name="l00385"></a>00385     <a class="code" href="thread__lib_8h.html#a053d64819b2af3c392e75d1462777e85">rq_queue_head</a>-&gt;isjob = <a class="code" href="thread__lib_8h.html#a2399e7523313bafdd7403991740403d9aa7f0b1894da53345d3b3083342d1b4a9">JOB_HAS</a>;
<a name="l00386"></a>00386     <a class="code" href="thread__lib_8h.html#a053d64819b2af3c392e75d1462777e85">rq_queue_head</a> = <a class="code" href="thread__lib_8h.html#a053d64819b2af3c392e75d1462777e85">rq_queue_head</a>-&gt;next;
<a name="l00387"></a>00387 
<a name="l00388"></a>00388     <span class="keywordflow">return</span> 0;
<a name="l00389"></a>00389 }
</pre></div></p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dynsection">
<div class="center"><img src="thread__lib_8h_a43b9e6b3d8f5ccd03ea395501d077839_cgraph.png" border="0" usemap="#thread__lib_8h_a43b9e6b3d8f5ccd03ea395501d077839_cgraph_map" alt=""></div>
<map name="thread__lib_8h_a43b9e6b3d8f5ccd03ea395501d077839_cgraph_map" id="thread__lib_8h_a43b9e6b3d8f5ccd03ea395501d077839_cgraph">
<area shape="rect" id="node3" href="time__lib_8c.html#a56b3a491c800d7a69fb6a2b20672f6b9" title="get_sec" alt="" coords="128,5,205,35"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dynsection">
<div class="center"><img src="thread__lib_8h_a43b9e6b3d8f5ccd03ea395501d077839_icgraph.png" border="0" usemap="#thread__lib_8h_a43b9e6b3d8f5ccd03ea395501d077839_icgraph_map" alt=""></div>
<map name="thread__lib_8h_a43b9e6b3d8f5ccd03ea395501d077839_icgraph_map" id="thread__lib_8h_a43b9e6b3d8f5ccd03ea395501d077839_icgraph">
<area shape="rect" id="node3" href="action__lib_8c.html#aa0a3e29d85bccc5eec69b0527c6d71fa" title="on_accept" alt="" coords="128,5,221,35"/><area shape="rect" id="node5" href="action__lib_8h.html#aff993b0c4844f0b3fa9336f377488b13" title="conn_new" alt="" coords="271,5,359,35"/><area shape="rect" id="node7" href="strawberry_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title="main" alt="" coords="409,5,463,35"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="abca92f29174fa6b30f9b90458ffb5982"></a><!-- doxytag: member="thread_lib.h::setup_thread" ref="abca92f29174fa6b30f9b90458ffb5982" args="(LIBEVENT_WORK_THREAD *me)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void setup_thread </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structLIBEVENT__WORK__THREAD.html">LIBEVENT_WORK_THREAD</a> *&nbsp;</td>
          <td class="paramname"> <em>me</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="thread__lib_8c_source.html#l00168">168</a> of file <a class="el" href="thread__lib_8c_source.html">thread_lib.c</a>.</p>

<p>References <a class="el" href="thread__lib_8h_source.html#l00075">LIBEVENT_WORK_THREAD::base</a>, <a class="el" href="log__lib_8c_source.html#l00011">d_log()</a>, <a class="el" href="thread__lib_8c_source.html#l00020">libevent_work_thread()</a>, <a class="el" href="thread__lib_8h_source.html#l00076">LIBEVENT_WORK_THREAD::notify_event</a>, and <a class="el" href="thread__lib_8h_source.html#l00077">LIBEVENT_WORK_THREAD::notify_read_fd</a>.</p>

<p>Referenced by <a class="el" href="thread__lib_8c_source.html#l00132">work_thread_init()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00168"></a>00168                                             {
<a name="l00169"></a>00169     me-&gt;<a class="code" href="structLIBEVENT__WORK__THREAD.html#ab1a154f7530a81e9dd1d63fc6b98a5c7">base</a> = event_init();
<a name="l00170"></a>00170     <span class="keywordflow">if</span> (! me-&gt;<a class="code" href="structLIBEVENT__WORK__THREAD.html#ab1a154f7530a81e9dd1d63fc6b98a5c7">base</a>) {
<a name="l00171"></a>00171         <a class="code" href="log__lib_8c.html#a2b52cdbe46ce30c842d4ab36ca9fe052">d_log</a>(<span class="stringliteral">&quot;error Can&apos;t allocate event base&quot;</span>);
<a name="l00172"></a>00172         exit(1);
<a name="l00173"></a>00173     }
<a name="l00174"></a>00174 
<a name="l00175"></a>00175     <span class="comment">/* Listen for notifications from other threads */</span>
<a name="l00176"></a>00176     event_set(&amp;me-&gt;<a class="code" href="structLIBEVENT__WORK__THREAD.html#ad564671e70e7aae8208dced0134608a6">notify_event</a>, me-&gt;<a class="code" href="structLIBEVENT__WORK__THREAD.html#a61d66138ede9b94b19c42da07b47375c">notify_read_fd</a>,
<a name="l00177"></a>00177               EV_READ | EV_PERSIST, <a class="code" href="thread__lib_8c.html#ae1cbb978768e1e410de39dd9adf3ce2e">libevent_work_thread</a>, me);
<a name="l00178"></a>00178     event_base_set(me-&gt;<a class="code" href="structLIBEVENT__WORK__THREAD.html#ab1a154f7530a81e9dd1d63fc6b98a5c7">base</a>, &amp;me-&gt;<a class="code" href="structLIBEVENT__WORK__THREAD.html#ad564671e70e7aae8208dced0134608a6">notify_event</a>);
<a name="l00179"></a>00179 
<a name="l00180"></a>00180     <span class="keywordflow">if</span> (event_add(&amp;me-&gt;<a class="code" href="structLIBEVENT__WORK__THREAD.html#ad564671e70e7aae8208dced0134608a6">notify_event</a>, 0) == -1) {
<a name="l00181"></a>00181         <a class="code" href="log__lib_8c.html#a2b52cdbe46ce30c842d4ab36ca9fe052">d_log</a>(<span class="stringliteral">&quot;Can&apos;t monitor libevent notify pipe&quot;</span>);
<a name="l00182"></a>00182         exit(1);
<a name="l00183"></a>00183     }
<a name="l00184"></a>00184 }
</pre></div></p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dynsection">
<div class="center"><img src="thread__lib_8h_abca92f29174fa6b30f9b90458ffb5982_cgraph.png" border="0" usemap="#thread__lib_8h_abca92f29174fa6b30f9b90458ffb5982_cgraph_map" alt=""></div>
<map name="thread__lib_8h_abca92f29174fa6b30f9b90458ffb5982_cgraph_map" id="thread__lib_8h_abca92f29174fa6b30f9b90458ffb5982_cgraph">
<area shape="rect" id="node3" href="log__lib_8c.html#a2b52cdbe46ce30c842d4ab36ca9fe052" title="d_log" alt="" coords="607,5,663,35"/><area shape="rect" id="node5" href="thread__lib_8c.html#ae1cbb978768e1e410de39dd9adf3ce2e" title="libevent_work_thread" alt="" coords="169,139,335,168"/><area shape="rect" id="node7" href="pg__protocol_8c.html#a2e80fd727d460b3d797b3ec4b2620f52" title="AuthPG" alt="" coords="421,112,493,141"/><area shape="rect" id="node11" href="socket__lib_8c.html#af47f95cdbc414ea7e9b9ffab1e1ba08d" title="Client_Init" alt="" coords="412,165,503,195"/><area shape="rect" id="node13" href="conf__lib_8c.html#aa34b509b14cc5e81b12c856549b62525" title="conf_get" alt="" coords="416,219,499,248"/><area shape="rect" id="node16" href="pg__protocol_8c.html#a8a78b0d7c16cf92ef2502025c1a134c2" title="PGStartupPacket3" alt="" coords="384,59,531,88"/><area shape="rect" id="node21" href="pg__protocol_8c.html#a17274e5d37fc9e0ce4b530d299072f66" title="resolve_slot" alt="" coords="407,272,508,301"/><area shape="rect" id="node23" href="pg__protocol_8c.html#a6eb5cf1f4f48facc6b554a4eda147a6a" title="Socket_Send" alt="" coords="403,325,512,355"/><area shape="rect" id="node9" href="pool__worker_8c.html#a543a71476898c79b560429dd6f9bc94b" title="freeHdr" alt="" coords="599,112,671,141"/><area shape="rect" id="node19" href="socket__lib_8c.html#aef7d9a1318d5dd934c3da007601ce730" title="Socket_Read" alt="" coords="580,59,689,88"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dynsection">
<div class="center"><img src="thread__lib_8h_abca92f29174fa6b30f9b90458ffb5982_icgraph.png" border="0" usemap="#thread__lib_8h_abca92f29174fa6b30f9b90458ffb5982_icgraph_map" alt=""></div>
<map name="thread__lib_8h_abca92f29174fa6b30f9b90458ffb5982_icgraph_map" id="thread__lib_8h_abca92f29174fa6b30f9b90458ffb5982_icgraph">
<area shape="rect" id="node3" href="thread__lib_8h.html#a91d70880b8de5d73665d2d9a7e46cd72" title="work_thread_init" alt="" coords="168,5,301,35"/><area shape="rect" id="node5" href="strawberry_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title="main" alt="" coords="351,5,404,35"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="aa386ef0ef688eeeaccbc7d36dba660e3"></a><!-- doxytag: member="thread_lib.h::setup_token" ref="aa386ef0ef688eeeaccbc7d36dba660e3" args="(void *(*func)(void *), void *arg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void setup_token </td>
          <td>(</td>
          <td class="paramtype">void *(*)(void *)&nbsp;</td>
          <td class="paramname"> <em>func</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>arg</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="thread__lib_8c_source.html#l00258">258</a> of file <a class="el" href="thread__lib_8c_source.html">thread_lib.c</a>.</p>

<p>References <a class="el" href="log__lib_8c_source.html#l00011">d_log()</a>.</p>

<p>Referenced by <a class="el" href="thread__lib_8c_source.html#l00235">token_thread_init()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00258"></a>00258                                                    {
<a name="l00259"></a>00259     pthread_t       thread;
<a name="l00260"></a>00260     pthread_attr_t  attr;
<a name="l00261"></a>00261     <span class="keywordtype">int</span> ret;
<a name="l00262"></a>00262     pthread_attr_init(&amp;attr);
<a name="l00263"></a>00263 
<a name="l00264"></a>00264     <span class="keywordflow">if</span> ((ret = pthread_create(&amp;thread, &amp;attr, func, arg)) != 0) {
<a name="l00265"></a>00265         <a class="code" href="log__lib_8c.html#a2b52cdbe46ce30c842d4ab36ca9fe052">d_log</a>(<span class="stringliteral">&quot;Can&apos;t create thread&quot;</span>);
<a name="l00266"></a>00266         exit(1);
<a name="l00267"></a>00267     }
<a name="l00268"></a>00268 }
</pre></div></p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dynsection">
<div class="center"><img src="thread__lib_8h_aa386ef0ef688eeeaccbc7d36dba660e3_cgraph.png" border="0" usemap="#thread__lib_8h_aa386ef0ef688eeeaccbc7d36dba660e3_cgraph_map" alt=""></div>
<map name="thread__lib_8h_aa386ef0ef688eeeaccbc7d36dba660e3_cgraph_map" id="thread__lib_8h_aa386ef0ef688eeeaccbc7d36dba660e3_cgraph">
<area shape="rect" id="node3" href="log__lib_8c.html#a2b52cdbe46ce30c842d4ab36ca9fe052" title="d_log" alt="" coords="160,5,216,35"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dynsection">
<div class="center"><img src="thread__lib_8h_aa386ef0ef688eeeaccbc7d36dba660e3_icgraph.png" border="0" usemap="#thread__lib_8h_aa386ef0ef688eeeaccbc7d36dba660e3_icgraph_map" alt=""></div>
<map name="thread__lib_8h_aa386ef0ef688eeeaccbc7d36dba660e3_icgraph_map" id="thread__lib_8h_aa386ef0ef688eeeaccbc7d36dba660e3_icgraph">
<area shape="rect" id="node3" href="thread__lib_8h.html#a3de5c4c46593aca56c44b3482d3f83bf" title="token_thread_init" alt="" coords="160,5,301,35"/><area shape="rect" id="node5" href="strawberry_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title="main" alt="" coords="351,5,404,35"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a3de5c4c46593aca56c44b3482d3f83bf"></a><!-- doxytag: member="thread_lib.h::token_thread_init" ref="a3de5c4c46593aca56c44b3482d3f83bf" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void token_thread_init </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="thread__lib_8c_source.html#l00235">235</a> of file <a class="el" href="thread__lib_8c_source.html">thread_lib.c</a>.</p>

<p>References <a class="el" href="thread__lib_8h_source.html#l00067">LIBEVENT_TOKEN_THREAD::base</a>, <a class="el" href="log__lib_8c_source.html#l00011">d_log()</a>, <a class="el" href="thread__lib_8c_source.html#l00275">libevent_token_thread()</a>, <a class="el" href="thread__lib_8c_source.html#l00270">main_token_thread()</a>, <a class="el" href="thread__lib_8h_source.html#l00068">LIBEVENT_TOKEN_THREAD::notify_event</a>, <a class="el" href="thread__lib_8c_source.html#l00258">setup_token()</a>, <a class="el" href="thread__lib_8h_source.html#l00135">token_efd</a>, and <a class="el" href="thread__lib_8h_source.html#l00126">token_thread</a>.</p>

<p>Referenced by <a class="el" href="strawberry_8c_source.html#l00021">main()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00235"></a>00235                         {
<a name="l00236"></a>00236 
<a name="l00237"></a>00237     <a class="code" href="thread__lib_8h.html#a0a76fcbcffd39af8a2424449ad11c84b">token_thread</a> = (<a class="code" href="structLIBEVENT__TOKEN__THREAD.html">LIBEVENT_TOKEN_THREAD</a> *)calloc(1, <span class="keyword">sizeof</span>(<a class="code" href="structLIBEVENT__TOKEN__THREAD.html">LIBEVENT_TOKEN_THREAD</a>));
<a name="l00238"></a>00238     <a class="code" href="thread__lib_8h.html#a0a76fcbcffd39af8a2424449ad11c84b">token_thread</a>-&gt;<a class="code" href="structLIBEVENT__TOKEN__THREAD.html#ab1a154f7530a81e9dd1d63fc6b98a5c7">base</a> = event_base_new();
<a name="l00239"></a>00239     <span class="keywordflow">if</span> (! <a class="code" href="thread__lib_8h.html#a0a76fcbcffd39af8a2424449ad11c84b">token_thread</a>-&gt;<a class="code" href="structLIBEVENT__TOKEN__THREAD.html#ab1a154f7530a81e9dd1d63fc6b98a5c7">base</a>) {
<a name="l00240"></a>00240         <a class="code" href="log__lib_8c.html#a2b52cdbe46ce30c842d4ab36ca9fe052">d_log</a>(<span class="stringliteral">&quot;error Can&apos;t allocate event base&quot;</span>);
<a name="l00241"></a>00241         exit(1);
<a name="l00242"></a>00242     }   
<a name="l00243"></a>00243     <a class="code" href="thread__lib_8h.html#a09c2d324fd63097f9021d920f3af2363">token_efd</a> = eventfd(0, 0);
<a name="l00244"></a>00244     <span class="keywordflow">if</span>(<a class="code" href="thread__lib_8h.html#a09c2d324fd63097f9021d920f3af2363">token_efd</a> == -1) exit(1);
<a name="l00245"></a>00245 
<a name="l00246"></a>00246     <span class="comment">/* Listen for notifications from other threads */</span>
<a name="l00247"></a>00247     event_set(&amp;<a class="code" href="thread__lib_8h.html#a0a76fcbcffd39af8a2424449ad11c84b">token_thread</a>-&gt;<a class="code" href="structLIBEVENT__TOKEN__THREAD.html#ad564671e70e7aae8208dced0134608a6">notify_event</a>, <a class="code" href="thread__lib_8h.html#a09c2d324fd63097f9021d920f3af2363">token_efd</a>,
<a name="l00248"></a>00248               EV_READ | EV_PERSIST, <a class="code" href="thread__lib_8c.html#a3fbea3c610df1ca3573dbeba2a6bc828">libevent_token_thread</a>, <a class="code" href="thread__lib_8h.html#a0a76fcbcffd39af8a2424449ad11c84b">token_thread</a>);
<a name="l00249"></a>00249     event_base_set(<a class="code" href="thread__lib_8h.html#a0a76fcbcffd39af8a2424449ad11c84b">token_thread</a>-&gt;<a class="code" href="structLIBEVENT__TOKEN__THREAD.html#ab1a154f7530a81e9dd1d63fc6b98a5c7">base</a>, &amp;<a class="code" href="thread__lib_8h.html#a0a76fcbcffd39af8a2424449ad11c84b">token_thread</a>-&gt;<a class="code" href="structLIBEVENT__TOKEN__THREAD.html#ad564671e70e7aae8208dced0134608a6">notify_event</a>);
<a name="l00250"></a>00250     <span class="keywordflow">if</span> (event_add(&amp;<a class="code" href="thread__lib_8h.html#a0a76fcbcffd39af8a2424449ad11c84b">token_thread</a>-&gt;<a class="code" href="structLIBEVENT__TOKEN__THREAD.html#ad564671e70e7aae8208dced0134608a6">notify_event</a>, 0) == -1) {
<a name="l00251"></a>00251         <a class="code" href="log__lib_8c.html#a2b52cdbe46ce30c842d4ab36ca9fe052">d_log</a>(<span class="stringliteral">&quot;Can&apos;t monitor libevent notify pipe&quot;</span>);
<a name="l00252"></a>00252         exit(1);
<a name="l00253"></a>00253     }   
<a name="l00254"></a>00254 
<a name="l00255"></a>00255     <a class="code" href="thread__lib_8c.html#aa386ef0ef688eeeaccbc7d36dba660e3">setup_token</a>(<a class="code" href="thread__lib_8c.html#a21be82a7539e180dc095cde37e71185d">main_token_thread</a>, <a class="code" href="thread__lib_8h.html#a0a76fcbcffd39af8a2424449ad11c84b">token_thread</a>);
<a name="l00256"></a>00256 }
</pre></div></p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dynsection">
<div class="center"><img src="thread__lib_8h_a3de5c4c46593aca56c44b3482d3f83bf_cgraph.png" border="0" usemap="#thread__lib_8h_a3de5c4c46593aca56c44b3482d3f83bf_cgraph_map" alt=""></div>
<map name="thread__lib_8h_a3de5c4c46593aca56c44b3482d3f83bf_cgraph_map" id="thread__lib_8h_a3de5c4c46593aca56c44b3482d3f83bf_cgraph">
<area shape="rect" id="node3" href="log__lib_8c.html#a2b52cdbe46ce30c842d4ab36ca9fe052" title="d_log" alt="" coords="424,111,480,140"/><area shape="rect" id="node5" href="thread__lib_8c.html#a3fbea3c610df1ca3573dbeba2a6bc828" title="libevent_token_thread" alt="" coords="196,5,369,35"/><area shape="rect" id="node9" href="thread__lib_8c.html#a21be82a7539e180dc095cde37e71185d" title="main_token_thread" alt="" coords="207,109,359,139"/><area shape="rect" id="node11" href="thread__lib_8c.html#aa386ef0ef688eeeaccbc7d36dba660e3" title="setup_token" alt="" coords="229,163,336,192"/><area shape="rect" id="node7" href="thread__lib_8c.html#a27f32dd63f1b359c3f46c70afb2c053c" title="rq_pop" alt="" coords="419,5,485,35"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dynsection">
<div class="center"><img src="thread__lib_8h_a3de5c4c46593aca56c44b3482d3f83bf_icgraph.png" border="0" usemap="#thread__lib_8h_a3de5c4c46593aca56c44b3482d3f83bf_icgraph_map" alt=""></div>
<map name="thread__lib_8h_a3de5c4c46593aca56c44b3482d3f83bf_icgraph_map" id="thread__lib_8h_a3de5c4c46593aca56c44b3482d3f83bf_icgraph">
<area shape="rect" id="node3" href="strawberry_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title="main" alt="" coords="196,5,249,35"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a91d70880b8de5d73665d2d9a7e46cd72"></a><!-- doxytag: member="thread_lib.h::work_thread_init" ref="a91d70880b8de5d73665d2d9a7e46cd72" args="(int nthreads)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void work_thread_init </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>nthreads</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="thread__lib_8c_source.html#l00132">132</a> of file <a class="el" href="thread__lib_8c_source.html">thread_lib.c</a>.</p>

<p>References <a class="el" href="thread__lib_8c_source.html#l00186">create_worker()</a>, <a class="el" href="thread__lib_8c_source.html#l00019">init_count</a>, <a class="el" href="thread__lib_8h_source.html#l00132">init_work_cond</a>, <a class="el" href="thread__lib_8h_source.html#l00131">init_work_lock</a>, <a class="el" href="thread__lib_8h_source.html#l00079">LIBEVENT_WORK_THREAD::no</a>, <a class="el" href="thread__lib_8h_source.html#l00077">LIBEVENT_WORK_THREAD::notify_read_fd</a>, <a class="el" href="thread__lib_8h_source.html#l00078">LIBEVENT_WORK_THREAD::notify_write_fd</a>, <a class="el" href="thread__lib_8c_source.html#l00168">setup_thread()</a>, <a class="el" href="thread__lib_8h_source.html#l00130">work_threads</a>, <a class="el" href="thread__lib_8c_source.html#l00199">worker_libevent()</a>, <a class="el" href="thread__lib_8h_source.html#l00121">wtq_queue_head</a>, and <a class="el" href="thread__lib_8h_source.html#l00122">wtq_queue_tail</a>.</p>

<p>Referenced by <a class="el" href="strawberry_8c_source.html#l00021">main()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00132"></a>00132                                    {
<a name="l00133"></a>00133     <span class="keywordtype">int</span> i;
<a name="l00134"></a>00134 
<a name="l00135"></a>00135     <a class="code" href="thread__lib_8h.html#a68b90dc047052c139e630b9d98632136">work_threads</a> = (<a class="code" href="structLIBEVENT__WORK__THREAD.html">LIBEVENT_WORK_THREAD</a> *)calloc(nthreads, <span class="keyword">sizeof</span>(<a class="code" href="structLIBEVENT__WORK__THREAD.html">LIBEVENT_WORK_THREAD</a>));    
<a name="l00136"></a>00136     <span class="keywordflow">if</span>(!<a class="code" href="thread__lib_8h.html#a68b90dc047052c139e630b9d98632136">work_threads</a>){
<a name="l00137"></a>00137         exit(1);
<a name="l00138"></a>00138     }
<a name="l00139"></a>00139 
<a name="l00140"></a>00140     <a class="code" href="thread__lib_8h.html#ade4b8482543f6f5e743df14dbe4942df">wtq_queue_tail</a> = <a class="code" href="thread__lib_8h.html#adb6be63082ac21a9a69b84d7458f3f09">wtq_queue_head</a> = NULL;
<a name="l00141"></a>00141 
<a name="l00142"></a>00142     pthread_mutex_init(&amp;<a class="code" href="thread__lib_8h.html#a8daa1262096450d589b1b7f0a65d5768">init_work_lock</a>, NULL);
<a name="l00143"></a>00143     pthread_cond_init(&amp;<a class="code" href="thread__lib_8h.html#a02f4081f9071171d0e5e0f3bf1201b6e">init_work_cond</a>, NULL);
<a name="l00144"></a>00144 
<a name="l00145"></a>00145     <span class="keywordflow">for</span>(i=0; i&lt; nthreads; i++){
<a name="l00146"></a>00146         <span class="keywordtype">int</span> fds[2];
<a name="l00147"></a>00147         <span class="keywordflow">if</span>(pipe(fds)){
<a name="l00148"></a>00148 
<a name="l00149"></a>00149         }
<a name="l00150"></a>00150         <a class="code" href="thread__lib_8h.html#a68b90dc047052c139e630b9d98632136">work_threads</a>[i].<a class="code" href="structLIBEVENT__WORK__THREAD.html#a61d66138ede9b94b19c42da07b47375c">notify_read_fd</a> = fds[0];
<a name="l00151"></a>00151         <a class="code" href="thread__lib_8h.html#a68b90dc047052c139e630b9d98632136">work_threads</a>[i].<a class="code" href="structLIBEVENT__WORK__THREAD.html#a864eecd6f2d9130d3a149c882899be51">notify_write_fd</a> = fds[1];
<a name="l00152"></a>00152         <a class="code" href="thread__lib_8h.html#a68b90dc047052c139e630b9d98632136">work_threads</a>[i].<a class="code" href="structLIBEVENT__WORK__THREAD.html#a196206e0ab201e18d79c3878336d7d20">no</a> = i;
<a name="l00153"></a>00153         <a class="code" href="thread__lib_8c.html#abca92f29174fa6b30f9b90458ffb5982">setup_thread</a>(&amp;<a class="code" href="thread__lib_8h.html#a68b90dc047052c139e630b9d98632136">work_threads</a>[i]);
<a name="l00154"></a>00154     }
<a name="l00155"></a>00155 
<a name="l00156"></a>00156     <span class="keywordflow">for</span>(i=0; i&lt;nthreads; i++){
<a name="l00157"></a>00157         <a class="code" href="thread__lib_8c.html#aa9aef0426afa41186b20a5b005083261">create_worker</a>(<a class="code" href="thread__lib_8c.html#a871abe96b184b7892ad67884fb5241b2">worker_libevent</a>, &amp;<a class="code" href="thread__lib_8h.html#a68b90dc047052c139e630b9d98632136">work_threads</a>[i]);
<a name="l00158"></a>00158     }
<a name="l00159"></a>00159 
<a name="l00160"></a>00160     pthread_mutex_lock(&amp;<a class="code" href="thread__lib_8h.html#a8daa1262096450d589b1b7f0a65d5768">init_work_lock</a>);
<a name="l00161"></a>00161     <span class="keywordflow">while</span> (<a class="code" href="thread__lib_8c.html#a40ca994ffbfad9b35b2c2f44df3e38b5">init_count</a> &lt; nthreads) {
<a name="l00162"></a>00162         pthread_cond_wait(&amp;<a class="code" href="thread__lib_8h.html#a02f4081f9071171d0e5e0f3bf1201b6e">init_work_cond</a>, &amp;<a class="code" href="thread__lib_8h.html#a8daa1262096450d589b1b7f0a65d5768">init_work_lock</a>);
<a name="l00163"></a>00163     }
<a name="l00164"></a>00164     <a class="code" href="thread__lib_8h.html#adb6be63082ac21a9a69b84d7458f3f09">wtq_queue_head</a>-&gt;next = <a class="code" href="thread__lib_8h.html#ade4b8482543f6f5e743df14dbe4942df">wtq_queue_tail</a>;
<a name="l00165"></a>00165     pthread_mutex_unlock(&amp;<a class="code" href="thread__lib_8h.html#a8daa1262096450d589b1b7f0a65d5768">init_work_lock</a>);
<a name="l00166"></a>00166 }
</pre></div></p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dynsection">
<div class="center"><img src="thread__lib_8h_a91d70880b8de5d73665d2d9a7e46cd72_cgraph.png" border="0" usemap="#thread__lib_8h_a91d70880b8de5d73665d2d9a7e46cd72_cgraph_map" alt=""></div>
<map name="thread__lib_8h_a91d70880b8de5d73665d2d9a7e46cd72_cgraph_map" id="thread__lib_8h_a91d70880b8de5d73665d2d9a7e46cd72_cgraph">
<area shape="rect" id="node3" href="thread__lib_8c.html#aa9aef0426afa41186b20a5b005083261" title="create_worker" alt="" coords="389,5,509,35"/><area shape="rect" id="node7" href="thread__lib_8c.html#abca92f29174fa6b30f9b90458ffb5982" title="setup_thread" alt="" coords="196,97,308,127"/><area shape="rect" id="node30" href="thread__lib_8c.html#a871abe96b184b7892ad67884fb5241b2" title="worker_libevent" alt="" coords="188,189,316,219"/><area shape="rect" id="node5" href="log__lib_8c.html#a2b52cdbe46ce30c842d4ab36ca9fe052" title="d_log" alt="" coords="804,136,860,165"/><area shape="rect" id="node10" href="thread__lib_8c.html#ae1cbb978768e1e410de39dd9adf3ce2e" title="libevent_work_thread" alt="" coords="367,215,532,244"/><area shape="rect" id="node12" href="pg__protocol_8c.html#a2e80fd727d460b3d797b3ec4b2620f52" title="AuthPG" alt="" coords="619,427,691,456"/><area shape="rect" id="node16" href="socket__lib_8c.html#af47f95cdbc414ea7e9b9ffab1e1ba08d" title="Client_Init" alt="" coords="609,320,700,349"/><area shape="rect" id="node18" href="conf__lib_8c.html#aa34b509b14cc5e81b12c856549b62525" title="conf_get" alt="" coords="613,373,696,403"/><area shape="rect" id="node21" href="pg__protocol_8c.html#a8a78b0d7c16cf92ef2502025c1a134c2" title="PGStartupPacket3" alt="" coords="581,267,728,296"/><area shape="rect" id="node26" href="pg__protocol_8c.html#a17274e5d37fc9e0ce4b530d299072f66" title="resolve_slot" alt="" coords="604,109,705,139"/><area shape="rect" id="node28" href="pg__protocol_8c.html#a6eb5cf1f4f48facc6b554a4eda147a6a" title="Socket_Send" alt="" coords="600,163,709,192"/><area shape="rect" id="node14" href="pool__worker_8c.html#a543a71476898c79b560429dd6f9bc94b" title="freeHdr" alt="" coords="796,427,868,456"/><area shape="rect" id="node24" href="socket__lib_8c.html#aef7d9a1318d5dd934c3da007601ce730" title="Socket_Read" alt="" coords="777,267,887,296"/><area shape="rect" id="node32" href="thread__lib_8c.html#a0a17a3b840f2ceccda116520d3652196" title="wtq_init" alt="" coords="412,268,487,297"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dynsection">
<div class="center"><img src="thread__lib_8h_a91d70880b8de5d73665d2d9a7e46cd72_icgraph.png" border="0" usemap="#thread__lib_8h_a91d70880b8de5d73665d2d9a7e46cd72_icgraph_map" alt=""></div>
<map name="thread__lib_8h_a91d70880b8de5d73665d2d9a7e46cd72_icgraph_map" id="thread__lib_8h_a91d70880b8de5d73665d2d9a7e46cd72_icgraph">
<area shape="rect" id="node3" href="strawberry_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title="main" alt="" coords="188,5,241,35"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a871abe96b184b7892ad67884fb5241b2"></a><!-- doxytag: member="thread_lib.h::worker_libevent" ref="a871abe96b184b7892ad67884fb5241b2" args="(void *arg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void* worker_libevent </td>
          <td>(</td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>arg</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="thread__lib_8c_source.html#l00199">199</a> of file <a class="el" href="thread__lib_8c_source.html">thread_lib.c</a>.</p>

<p>References <a class="el" href="thread__lib_8h_source.html#l00075">LIBEVENT_WORK_THREAD::base</a>, <a class="el" href="thread__lib_8c_source.html#l00019">init_count</a>, <a class="el" href="thread__lib_8h_source.html#l00132">init_work_cond</a>, <a class="el" href="thread__lib_8h_source.html#l00131">init_work_lock</a>, <a class="el" href="thread__lib_8h_source.html#l00079">LIBEVENT_WORK_THREAD::no</a>, <a class="el" href="thread__lib_8h_source.html#l00074">LIBEVENT_WORK_THREAD::thread_id</a>, <a class="el" href="thread__lib_8c_source.html#l00426">wtq_init()</a>, <a class="el" href="thread__lib_8h_source.html#l00121">wtq_queue_head</a>, and <a class="el" href="thread__lib_8h_source.html#l00122">wtq_queue_tail</a>.</p>

<p>Referenced by <a class="el" href="thread__lib_8c_source.html#l00132">work_thread_init()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00199"></a>00199                                  {
<a name="l00200"></a>00200     WTQ *work_child;
<a name="l00201"></a>00201 
<a name="l00202"></a>00202     <a class="code" href="structLIBEVENT__WORK__THREAD.html">LIBEVENT_WORK_THREAD</a> *me = (<a class="code" href="structLIBEVENT__WORK__THREAD.html">LIBEVENT_WORK_THREAD</a> *)arg;
<a name="l00203"></a>00203 
<a name="l00204"></a>00204     <span class="comment">/* Any per-thread setup can happen here; thread_init() will block until</span>
<a name="l00205"></a>00205 <span class="comment">     * all threads have finished initializing.</span>
<a name="l00206"></a>00206 <span class="comment">     */</span>
<a name="l00207"></a>00207     
<a name="l00208"></a>00208     pthread_mutex_lock(&amp;<a class="code" href="thread__lib_8h.html#a8daa1262096450d589b1b7f0a65d5768">init_work_lock</a>);
<a name="l00209"></a>00209     
<a name="l00210"></a>00210     work_child = <a class="code" href="thread__lib_8c.html#a0a17a3b840f2ceccda116520d3652196">wtq_init</a>();     
<a name="l00211"></a>00211     work_child-&gt;pid = pthread_self();
<a name="l00212"></a>00212     me-&gt;<a class="code" href="structLIBEVENT__WORK__THREAD.html#a614409619094fd8c0c6b522c400ffeea">thread_id</a> = work_child-&gt;pid;
<a name="l00213"></a>00213 
<a name="l00214"></a>00214     work_child-&gt;no = me-&gt;<a class="code" href="structLIBEVENT__WORK__THREAD.html#a196206e0ab201e18d79c3878336d7d20">no</a>;
<a name="l00215"></a>00215 
<a name="l00216"></a>00216     <span class="keywordflow">if</span>(<a class="code" href="thread__lib_8h.html#adb6be63082ac21a9a69b84d7458f3f09">wtq_queue_head</a> == NULL){
<a name="l00217"></a>00217         <a class="code" href="thread__lib_8h.html#ade4b8482543f6f5e743df14dbe4942df">wtq_queue_tail</a> = <a class="code" href="thread__lib_8h.html#adb6be63082ac21a9a69b84d7458f3f09">wtq_queue_head</a> = work_child;
<a name="l00218"></a>00218     }<span class="keywordflow">else</span>{
<a name="l00219"></a>00219         <a class="code" href="thread__lib_8h.html#adb6be63082ac21a9a69b84d7458f3f09">wtq_queue_head</a>-&gt;next = work_child;
<a name="l00220"></a>00220         <a class="code" href="thread__lib_8h.html#adb6be63082ac21a9a69b84d7458f3f09">wtq_queue_head</a> = work_child;
<a name="l00221"></a>00221     }
<a name="l00222"></a>00222 
<a name="l00223"></a>00223     <a class="code" href="thread__lib_8c.html#a40ca994ffbfad9b35b2c2f44df3e38b5">init_count</a>++;
<a name="l00224"></a>00224     <span class="comment">/*  error_add(pthread_self());*/</span>
<a name="l00225"></a>00225     pthread_cond_signal(&amp;<a class="code" href="thread__lib_8h.html#a02f4081f9071171d0e5e0f3bf1201b6e">init_work_cond</a>);
<a name="l00226"></a>00226     pthread_mutex_unlock(&amp;<a class="code" href="thread__lib_8h.html#a8daa1262096450d589b1b7f0a65d5768">init_work_lock</a>);
<a name="l00227"></a>00227 
<a name="l00228"></a>00228     <a class="code" href="thread__lib_8h.html#adb6be63082ac21a9a69b84d7458f3f09">wtq_queue_head</a>-&gt;next = <a class="code" href="thread__lib_8h.html#ade4b8482543f6f5e743df14dbe4942df">wtq_queue_tail</a>;
<a name="l00229"></a>00229 
<a name="l00230"></a>00230     event_base_loop(me-&gt;<a class="code" href="structLIBEVENT__WORK__THREAD.html#ab1a154f7530a81e9dd1d63fc6b98a5c7">base</a>, 0);
<a name="l00231"></a>00231 }
</pre></div></p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dynsection">
<div class="center"><img src="thread__lib_8h_a871abe96b184b7892ad67884fb5241b2_cgraph.png" border="0" usemap="#thread__lib_8h_a871abe96b184b7892ad67884fb5241b2_cgraph_map" alt=""></div>
<map name="thread__lib_8h_a871abe96b184b7892ad67884fb5241b2_cgraph_map" id="thread__lib_8h_a871abe96b184b7892ad67884fb5241b2_cgraph">
<area shape="rect" id="node3" href="thread__lib_8c.html#a0a17a3b840f2ceccda116520d3652196" title="wtq_init" alt="" coords="185,5,260,35"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dynsection">
<div class="center"><img src="thread__lib_8h_a871abe96b184b7892ad67884fb5241b2_icgraph.png" border="0" usemap="#thread__lib_8h_a871abe96b184b7892ad67884fb5241b2_icgraph_map" alt=""></div>
<map name="thread__lib_8h_a871abe96b184b7892ad67884fb5241b2_icgraph_map" id="thread__lib_8h_a871abe96b184b7892ad67884fb5241b2_icgraph">
<area shape="rect" id="node3" href="thread__lib_8h.html#a91d70880b8de5d73665d2d9a7e46cd72" title="work_thread_init" alt="" coords="184,5,317,35"/><area shape="rect" id="node5" href="strawberry_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title="main" alt="" coords="367,5,420,35"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a0a17a3b840f2ceccda116520d3652196"></a><!-- doxytag: member="thread_lib.h::wtq_init" ref="a0a17a3b840f2ceccda116520d3652196" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">WTQ* wtq_init </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="thread__lib_8c_source.html#l00426">426</a> of file <a class="el" href="thread__lib_8c_source.html">thread_lib.c</a>.</p>

<p>References <a class="el" href="pg__protocol_8h_source.html#l00031">MAX_BACKEND_SESSION</a>.</p>

<p>Referenced by <a class="el" href="thread__lib_8c_source.html#l00199">worker_libevent()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00426"></a>00426                {
<a name="l00427"></a>00427 
<a name="l00428"></a>00428     WTQ *work_child;
<a name="l00429"></a>00429     work_child = (WTQ *)calloc(1, <span class="keyword">sizeof</span>(WTQ));
<a name="l00430"></a>00430     work_child-&gt;rq_item = NULL;
<a name="l00431"></a>00431     bzero(work_child-&gt;slots, <a class="code" href="pg__protocol_8h.html#a3684b7c40ee669713097b82b65d756e7">MAX_BACKEND_SESSION</a>);
<a name="l00432"></a>00432     work_child-&gt;next = NULL;
<a name="l00433"></a>00433     
<a name="l00434"></a>00434     <span class="keywordflow">return</span> work_child;
<a name="l00435"></a>00435 }
</pre></div></p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dynsection">
<div class="center"><img src="thread__lib_8h_a0a17a3b840f2ceccda116520d3652196_icgraph.png" border="0" usemap="#thread__lib_8h_a0a17a3b840f2ceccda116520d3652196_icgraph_map" alt=""></div>
<map name="thread__lib_8h_a0a17a3b840f2ceccda116520d3652196_icgraph_map" id="thread__lib_8h_a0a17a3b840f2ceccda116520d3652196_icgraph">
<area shape="rect" id="node3" href="thread__lib_8h.html#a871abe96b184b7892ad67884fb5241b2" title="worker_libevent" alt="" coords="132,5,260,35"/><area shape="rect" id="node5" href="thread__lib_8h.html#a91d70880b8de5d73665d2d9a7e46cd72" title="work_thread_init" alt="" coords="309,5,443,35"/><area shape="rect" id="node7" href="strawberry_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title="main" alt="" coords="492,5,545,35"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a4b162ad8cc7e6ec222a4221629064f93"></a><!-- doxytag: member="thread_lib.h::wtq_pop" ref="a4b162ad8cc7e6ec222a4221629064f93" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">WTQ* wtq_pop </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a48f85459e8ab18639355dc642da2a4b7"></a><!-- doxytag: member="thread_lib.h::wtq_push" ref="a48f85459e8ab18639355dc642da2a4b7" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void wtq_push </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<hr/><h2>Variable Documentation</h2>
<a class="anchor" id="ae7d6617bd5b26756981768606da7d93e"></a><!-- doxytag: member="thread_lib.h::conns" ref="ae7d6617bd5b26756981768606da7d93e" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structconn.html">conn</a>* <a class="el" href="thread__lib_8h.html#ae7d6617bd5b26756981768606da7d93e">conns</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="thread__lib_8h_source.html#l00116">116</a> of file <a class="el" href="thread__lib_8h_source.html">thread_lib.h</a>.</p>

<p>Referenced by <a class="el" href="action__lib_8c_source.html#l00063">conn_new()</a>.</p>

</div>
</div>
<a class="anchor" id="a02f4081f9071171d0e5e0f3bf1201b6e"></a><!-- doxytag: member="thread_lib.h::init_work_cond" ref="a02f4081f9071171d0e5e0f3bf1201b6e" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">pthread_cond_t <a class="el" href="thread__lib_8h.html#a02f4081f9071171d0e5e0f3bf1201b6e">init_work_cond</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="thread__lib_8h_source.html#l00132">132</a> of file <a class="el" href="thread__lib_8h_source.html">thread_lib.h</a>.</p>

<p>Referenced by <a class="el" href="thread__lib_8c_source.html#l00132">work_thread_init()</a>, and <a class="el" href="thread__lib_8c_source.html#l00199">worker_libevent()</a>.</p>

</div>
</div>
<a class="anchor" id="a8daa1262096450d589b1b7f0a65d5768"></a><!-- doxytag: member="thread_lib.h::init_work_lock" ref="a8daa1262096450d589b1b7f0a65d5768" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">pthread_mutex_t <a class="el" href="thread__lib_8h.html#a8daa1262096450d589b1b7f0a65d5768">init_work_lock</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="thread__lib_8h_source.html#l00131">131</a> of file <a class="el" href="thread__lib_8h_source.html">thread_lib.h</a>.</p>

<p>Referenced by <a class="el" href="thread__lib_8c_source.html#l00132">work_thread_init()</a>, and <a class="el" href="thread__lib_8c_source.html#l00199">worker_libevent()</a>.</p>

</div>
</div>
<a class="anchor" id="ab2007460e3f06398c4264137c1a06075"></a><!-- doxytag: member="thread_lib.h::main_base" ref="ab2007460e3f06398c4264137c1a06075" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct event_base* <a class="el" href="thread__lib_8h.html#ab2007460e3f06398c4264137c1a06075">main_base</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="thread__lib_8h_source.html#l00124">124</a> of file <a class="el" href="thread__lib_8h_source.html">thread_lib.h</a>.</p>

<p>Referenced by <a class="el" href="strawberry_8c_source.html#l00021">main()</a>.</p>

</div>
</div>
<a class="anchor" id="a3fee839a6d9eee1090fa3987088be641"></a><!-- doxytag: member="thread_lib.h::notify_token_thread" ref="a3fee839a6d9eee1090fa3987088be641" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="thread__lib_8h.html#a3a97eb94bafe8d0c241194c797baaa86">NOTIFY_TOKEN_STATE</a> <a class="el" href="thread__lib_8h.html#a3fee839a6d9eee1090fa3987088be641">notify_token_thread</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="thread__lib_8h_source.html#l00127">127</a> of file <a class="el" href="thread__lib_8h_source.html">thread_lib.h</a>.</p>

<p>Referenced by <a class="el" href="thread__lib_8c_source.html#l00275">libevent_token_thread()</a>, <a class="el" href="thread__lib_8c_source.html#l00020">libevent_work_thread()</a>, <a class="el" href="strawberry_8c_source.html#l00021">main()</a>, and <a class="el" href="action__lib_8c_source.html#l00014">on_accept()</a>.</p>

</div>
</div>
<a class="anchor" id="a053d64819b2af3c392e75d1462777e85"></a><!-- doxytag: member="thread_lib.h::rq_queue_head" ref="a053d64819b2af3c392e75d1462777e85" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">RQ* <a class="el" href="thread__lib_8h.html#a053d64819b2af3c392e75d1462777e85">rq_queue_head</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="thread__lib_8h_source.html#l00118">118</a> of file <a class="el" href="thread__lib_8h_source.html">thread_lib.h</a>.</p>

<p>Referenced by <a class="el" href="thread__lib_8c_source.html#l00353">rq_init()</a>, and <a class="el" href="thread__lib_8c_source.html#l00377">rq_push()</a>.</p>

</div>
</div>
<a class="anchor" id="adff01cf5810f3295f7a070fa9d206304"></a><!-- doxytag: member="thread_lib.h::rq_queue_tail" ref="adff01cf5810f3295f7a070fa9d206304" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">RQ* <a class="el" href="thread__lib_8h.html#adff01cf5810f3295f7a070fa9d206304">rq_queue_tail</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="thread__lib_8h_source.html#l00119">119</a> of file <a class="el" href="thread__lib_8h_source.html">thread_lib.h</a>.</p>

<p>Referenced by <a class="el" href="thread__lib_8c_source.html#l00353">rq_init()</a>, and <a class="el" href="thread__lib_8c_source.html#l00394">rq_pop()</a>.</p>

</div>
</div>
<a class="anchor" id="a09c2d324fd63097f9021d920f3af2363"></a><!-- doxytag: member="thread_lib.h::token_efd" ref="a09c2d324fd63097f9021d920f3af2363" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="thread__lib_8h.html#a09c2d324fd63097f9021d920f3af2363">token_efd</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="thread__lib_8h_source.html#l00135">135</a> of file <a class="el" href="thread__lib_8h_source.html">thread_lib.h</a>.</p>

<p>Referenced by <a class="el" href="thread__lib_8c_source.html#l00275">libevent_token_thread()</a>, <a class="el" href="thread__lib_8c_source.html#l00020">libevent_work_thread()</a>, <a class="el" href="action__lib_8c_source.html#l00014">on_accept()</a>, and <a class="el" href="thread__lib_8c_source.html#l00235">token_thread_init()</a>.</p>

</div>
</div>
<a class="anchor" id="a0a76fcbcffd39af8a2424449ad11c84b"></a><!-- doxytag: member="thread_lib.h::token_thread" ref="a0a76fcbcffd39af8a2424449ad11c84b" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structLIBEVENT__TOKEN__THREAD.html">LIBEVENT_TOKEN_THREAD</a>* <a class="el" href="thread__lib_8h.html#a0a76fcbcffd39af8a2424449ad11c84b">token_thread</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="thread__lib_8h_source.html#l00126">126</a> of file <a class="el" href="thread__lib_8h_source.html">thread_lib.h</a>.</p>

<p>Referenced by <a class="el" href="thread__lib_8c_source.html#l00235">token_thread_init()</a>.</p>

</div>
</div>
<a class="anchor" id="a68b90dc047052c139e630b9d98632136"></a><!-- doxytag: member="thread_lib.h::work_threads" ref="a68b90dc047052c139e630b9d98632136" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structLIBEVENT__WORK__THREAD.html">LIBEVENT_WORK_THREAD</a>* <a class="el" href="thread__lib_8h.html#a68b90dc047052c139e630b9d98632136">work_threads</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="thread__lib_8h_source.html#l00130">130</a> of file <a class="el" href="thread__lib_8h_source.html">thread_lib.h</a>.</p>

<p>Referenced by <a class="el" href="thread__lib_8c_source.html#l00275">libevent_token_thread()</a>, and <a class="el" href="thread__lib_8c_source.html#l00132">work_thread_init()</a>.</p>

</div>
</div>
<a class="anchor" id="adb6be63082ac21a9a69b84d7458f3f09"></a><!-- doxytag: member="thread_lib.h::wtq_queue_head" ref="adb6be63082ac21a9a69b84d7458f3f09" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">WTQ* <a class="el" href="thread__lib_8h.html#adb6be63082ac21a9a69b84d7458f3f09">wtq_queue_head</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="thread__lib_8h_source.html#l00121">121</a> of file <a class="el" href="thread__lib_8h_source.html">thread_lib.h</a>.</p>

<p>Referenced by <a class="el" href="thread__lib_8c_source.html#l00132">work_thread_init()</a>, and <a class="el" href="thread__lib_8c_source.html#l00199">worker_libevent()</a>.</p>

</div>
</div>
<a class="anchor" id="ade4b8482543f6f5e743df14dbe4942df"></a><!-- doxytag: member="thread_lib.h::wtq_queue_tail" ref="ade4b8482543f6f5e743df14dbe4942df" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">WTQ* <a class="el" href="thread__lib_8h.html#ade4b8482543f6f5e743df14dbe4942df">wtq_queue_tail</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="thread__lib_8h_source.html#l00122">122</a> of file <a class="el" href="thread__lib_8h_source.html">thread_lib.h</a>.</p>

<p>Referenced by <a class="el" href="thread__lib_8c_source.html#l00275">libevent_token_thread()</a>, <a class="el" href="thread__lib_8c_source.html#l00020">libevent_work_thread()</a>, <a class="el" href="thread__lib_8c_source.html#l00132">work_thread_init()</a>, and <a class="el" href="thread__lib_8c_source.html#l00199">worker_libevent()</a>.</p>

</div>
</div>
</div>
<hr size="1"/><address style="text-align: right;"><small>Generated on 23 Dec 2013 for fdbc by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
