<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>fdbc: hashtable/pool_struct.h Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<h1>hashtable/pool_struct.h</h1><a href="pool__struct_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment"> * =====================================================================================</span>
<a name="l00003"></a>00003 <span class="comment"> *</span>
<a name="l00004"></a>00004 <span class="comment"> *       Filename:  pool_struct.h</span>
<a name="l00005"></a>00005 <span class="comment"> *</span>
<a name="l00006"></a>00006 <span class="comment"> *    Description:  </span>
<a name="l00007"></a>00007 <span class="comment"> *</span>
<a name="l00008"></a>00008 <span class="comment"> *        Version:  1.0</span>
<a name="l00009"></a>00009 <span class="comment"> *        Created:  12/11/2013 10:05:26 AM</span>
<a name="l00010"></a>00010 <span class="comment"> *       Revision:  none</span>
<a name="l00011"></a>00011 <span class="comment"> *       Compiler:  gcc</span>
<a name="l00012"></a>00012 <span class="comment"> *</span>
<a name="l00013"></a>00013 <span class="comment"> *         Author:  vyouzhi (), </span>
<a name="l00014"></a>00014 <span class="comment"> *   Organization:  </span>
<a name="l00015"></a>00015 <span class="comment"> *</span>
<a name="l00016"></a>00016 <span class="comment"> * =====================================================================================</span>
<a name="l00017"></a>00017 <span class="comment"> */</span>
<a name="l00018"></a>00018 <span class="preprocessor">#ifndef POOL_STRUCT_H</span>
<a name="l00019"></a>00019 <span class="preprocessor"></span><span class="preprocessor">#define POOL_STRUCT_H</span>
<a name="l00020"></a>00020 <span class="preprocessor"></span><span class="preprocessor">#ifdef __cplusplus</span>
<a name="l00021"></a>00021 <span class="preprocessor"></span> <span class="keyword">extern</span> <span class="stringliteral">&quot;C&quot;</span>
<a name="l00022"></a>00022  {
<a name="l00023"></a>00023 <span class="preprocessor">#endif</span>
<a name="l00024"></a>00024 <span class="preprocessor"></span>
<a name="l00025"></a>00025 <span class="preprocessor">#include &lt;pthread.h&gt;</span>
<a name="l00026"></a>00026 
<a name="l00027"></a>00027 <span class="preprocessor">#include &quot;../config_global.h&quot;</span>
<a name="l00028"></a>00028 <span class="preprocessor">#include &quot;../parser/da.h&quot;</span>
<a name="l00029"></a>00029 <span class="preprocessor">#include &quot;../parser/sql1.h&quot;</span>
<a name="l00030"></a>00030 <span class="preprocessor">#include &quot;../time_lib.h&quot;</span>
<a name="l00031"></a>00031 
<a name="l00032"></a>00032 <span class="preprocessor">#include &quot;<a class="code" href="lookupa_8h.html">lookupa.h</a>&quot;</span>
<a name="l00033"></a>00033 
<a name="l00034"></a><a class="code" href="pool__struct_8h.html#aa15da5bab57fcf2f77017725bd628a91">00034</a> <span class="preprocessor">#define MAX_HITEM_LENGTH 1024</span>
<a name="l00035"></a><a class="code" href="pool__struct_8h.html#aea9146141d6f9c74e578be7a0d7018f1">00035</a> <span class="preprocessor"></span><span class="preprocessor">#define MAX_HITEM_LENGTH_8 (MAX_HITEM_LENGTH&lt;&lt;8)</span>
<a name="l00036"></a><a class="code" href="pool__struct_8h.html#a6c41427e07ce1de3888c2bc77842958d">00036</a> <span class="preprocessor"></span><span class="preprocessor">#define MAX_HARU_POOL 1024</span>
<a name="l00037"></a><a class="code" href="pool__struct_8h.html#a1106f09f9f2864334a2d6759c334f7c6">00037</a> <span class="preprocessor"></span><span class="preprocessor">#define MAX_SLAB_CLASS  200</span>
<a name="l00038"></a><a class="code" href="pool__struct_8h.html#a8cd56df53d2341debe15fafe411515a6">00038</a> <span class="preprocessor"></span><span class="preprocessor">#define CHUNK_ALIGN_BYTES 8</span>
<a name="l00039"></a><a class="code" href="pool__struct_8h.html#aa18d1902acdd3742366b1b30037e0f28">00039</a> <span class="preprocessor"></span><span class="preprocessor">#define MAX_SLAB_BYTE 1024 * 1024</span>
<a name="l00040"></a><a class="code" href="pool__struct_8h.html#a546e87a45e2632f62630ae271740f891">00040</a> <span class="preprocessor"></span><span class="preprocessor">#define LIMIT_SLAB_BYTE 1024 * 1024</span>
<a name="l00041"></a><a class="code" href="pool__struct_8h.html#a31097271a95aad3aec8b90e71e69a079">00041</a> <span class="preprocessor"></span><span class="preprocessor">#define SLAB_BEGIN 88</span>
<a name="l00042"></a><a class="code" href="pool__struct_8h.html#afbc1ec14d8a33624efdb5f8183f750b3">00042</a> <span class="preprocessor"></span><span class="preprocessor">#define LIMIT_PERCENT 0.1</span>
<a name="l00043"></a>00043 <span class="preprocessor"></span><span class="comment">/* </span>
<a name="l00044"></a>00044 <span class="comment"> * f=1.25</span>
<a name="l00045"></a>00045 <span class="comment"> * slab class   1: chunk size     88 perslab 11915</span>
<a name="l00046"></a>00046 <span class="comment"> * slab class   2: chunk size    112 perslab  9362</span>
<a name="l00047"></a>00047 <span class="comment"> * slab class   3: chunk size    144 perslab  7281</span>
<a name="l00048"></a>00048 <span class="comment"> * slab class   4: chunk size    184 perslab  5698</span>
<a name="l00049"></a>00049 <span class="comment"> * slab class   5: chunk size    232 perslab  4519</span>
<a name="l00050"></a>00050 <span class="comment"> * slab class   6: chunk size    296 perslab  3542 </span>
<a name="l00051"></a>00051 <span class="comment"> * ...</span>
<a name="l00052"></a>00052 <span class="comment"> * slab class  37: chunk size 312976 perslab     3  </span>
<a name="l00053"></a>00053 <span class="comment"> * slab class  38: chunk size 391224 perslab     2  </span>
<a name="l00054"></a>00054 <span class="comment"> * slab class  39: chunk size 489032 perslab     2  </span>
<a name="l00055"></a>00055 <span class="comment"> * */</span>
<a name="l00056"></a><a class="code" href="pool__struct_8h.html#ac6c488c4d83e0b8ebc22e427bf653e5f">00056</a> <span class="keyword">typedef</span> <span class="keyword">enum</span> {
<a name="l00057"></a><a class="code" href="pool__struct_8h.html#ac6c488c4d83e0b8ebc22e427bf653e5fa3caee96280a82e0e6c5460ef3aaac87d">00057</a>     <a class="code" href="pool__struct_8h.html#ac6c488c4d83e0b8ebc22e427bf653e5fa3caee96280a82e0e6c5460ef3aaac87d">H_TRUE</a>=0,  <span class="comment">/* default 0 ,it&apos;s 1 has a job, 2 working */</span>   
<a name="l00058"></a><a class="code" href="pool__struct_8h.html#ac6c488c4d83e0b8ebc22e427bf653e5fa2392a8832076832ab60d48edb2d8cf95">00058</a>     <a class="code" href="pool__struct_8h.html#ac6c488c4d83e0b8ebc22e427bf653e5fa2392a8832076832ab60d48edb2d8cf95">H_FALSE</a>
<a name="l00059"></a>00059 } <a class="code" href="pool__struct_8h.html#ac6c488c4d83e0b8ebc22e427bf653e5f">H_STATE</a>;
<a name="l00060"></a>00060 
<a name="l00061"></a><a class="code" href="pool__struct_8h.html#a6a423ab83907ca236623e457dbc6f034">00061</a> <span class="keyword">typedef</span> <span class="keyword">enum</span> {
<a name="l00062"></a><a class="code" href="pool__struct_8h.html#a6a423ab83907ca236623e457dbc6f034ac862335fd77fece4b6ebc30ed10d2697">00062</a>     <a class="code" href="pool__struct_8h.html#a6a423ab83907ca236623e457dbc6f034ac862335fd77fece4b6ebc30ed10d2697">H_INSERT</a>=0,  <span class="comment">/* default 0 ,it&apos;s 1 has a job, 2 working */</span>   
<a name="l00063"></a><a class="code" href="pool__struct_8h.html#a6a423ab83907ca236623e457dbc6f034a972d8513bf2bd86ff41fefad46b484f0">00063</a>     <a class="code" href="pool__struct_8h.html#a6a423ab83907ca236623e457dbc6f034a972d8513bf2bd86ff41fefad46b484f0">H_UPDATE</a>
<a name="l00064"></a>00064 } <a class="code" href="pool__struct_8h.html#a6a423ab83907ca236623e457dbc6f034">H_CHANGE</a>;
<a name="l00065"></a>00065 
<a name="l00066"></a>00066 
<a name="l00067"></a><a class="code" href="struct____slabpack.html">00067</a> <span class="keyword">struct </span><a class="code" href="struct____slabpack.html">__slabpack</a> {
<a name="l00068"></a><a class="code" href="struct____slabpack.html#a213ee57d2e8c0c3cd14ac9f22cd7eb15">00068</a>     <span class="keywordtype">char</span> *<a class="code" href="struct____slabpack.html#a213ee57d2e8c0c3cd14ac9f22cd7eb15">pack</a>;
<a name="l00069"></a><a class="code" href="struct____slabpack.html#afed088663f8704004425cdae2120b9b3">00069</a>     <span class="keywordtype">int</span>  <a class="code" href="struct____slabpack.html#afed088663f8704004425cdae2120b9b3">len</a>;
<a name="l00070"></a>00070 };                              <span class="comment">/* ----------  end of struct __slabpack  ---------- */</span>
<a name="l00071"></a>00071 
<a name="l00072"></a>00072 <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="struct____slabpack.html">__slabpack</a> SLABPACK;
<a name="l00073"></a>00073 
<a name="l00074"></a><a class="code" href="struct____hslab.html">00074</a> <span class="keyword">struct </span><a class="code" href="struct____hslab.html">__hslab</a>
<a name="l00075"></a>00075 {
<a name="l00076"></a><a class="code" href="struct____hslab.html#a1991a2546e70ff00d0d89bffda9208cb">00076</a>   <a class="code" href="config__global_8h.html#a5e0e444ca36facaa313c7f26758b6dd0">ub1</a>           *<a class="code" href="struct____hslab.html#a1991a2546e70ff00d0d89bffda9208cb">sm</a>;      <span class="comment">/* slab malloc 1M */</span>
<a name="l00077"></a><a class="code" href="struct____hslab.html#ab2fa12cdbe72996f060d044f45996305">00077</a>   <a class="code" href="config__global_8h.html#a3fece3757bfd6deee681fb0d1fd41f97">ub4</a>           <a class="code" href="struct____hslab.html#ab2fa12cdbe72996f060d044f45996305">ss</a>;      <span class="comment">/* start of pool malloc */</span>
<a name="l00078"></a><a class="code" href="struct____hslab.html#a5ff458c2ab525ead01ec0fb186fb79b7">00078</a>   <a class="code" href="config__global_8h.html#a3fece3757bfd6deee681fb0d1fd41f97">ub4</a>           <a class="code" href="struct____hslab.html#a5ff458c2ab525ead01ec0fb186fb79b7">sf</a>;      <span class="comment">/* free of pool malloc if(sf==0) check fslab if return == -1 mount next*/</span>
<a name="l00079"></a><a class="code" href="struct____hslab.html#acc014c5a52c9b8889f80208036be627c">00079</a>   <a class="code" href="config__global_8h.html#a86dc967583a237dd2bc149d03760364d">sb2</a>           <a class="code" href="struct____hslab.html#acc014c5a52c9b8889f80208036be627c">id</a>;       <span class="comment">/* slab id */</span>
<a name="l00080"></a><a class="code" href="struct____hslab.html#a636924e0dd6f06d1ae54d6561a7e5256">00080</a>   <span class="keyword">struct </span><a class="code" href="struct____hslab.html">__hslab</a> *<a class="code" href="struct____hslab.html#a636924e0dd6f06d1ae54d6561a7e5256">next</a>;     <span class="comment">/* next */</span>
<a name="l00081"></a>00081 };
<a name="l00082"></a>00082 <span class="keyword">typedef</span>  <span class="keyword">struct </span><a class="code" href="struct____hslab.html">__hslab</a>  HSLAB;
<a name="l00083"></a>00083 
<a name="l00084"></a>00084 
<a name="l00085"></a>00085 <span class="comment">/* record the unlink slab */</span>
<a name="l00086"></a><a class="code" href="struct____fslab.html">00086</a> <span class="keyword">struct </span><a class="code" href="struct____fslab.html">__fslab</a>
<a name="l00087"></a>00087 {
<a name="l00088"></a><a class="code" href="struct____fslab.html#acce5c6a469decf13fff136dddee36012">00088</a>   <a class="code" href="config__global_8h.html#a86dc967583a237dd2bc149d03760364d">sb2</a>           <a class="code" href="struct____fslab.html#acce5c6a469decf13fff136dddee36012">psize</a>;     <span class="comment">/* hpool size */</span>
<a name="l00089"></a><a class="code" href="struct____fslab.html#a933ed6ebfd18421ca0c626a6c3ba8ff0">00089</a>   <a class="code" href="config__global_8h.html#a86dc967583a237dd2bc149d03760364d">sb2</a>           <a class="code" href="struct____fslab.html#a933ed6ebfd18421ca0c626a6c3ba8ff0">sid</a>;       <span class="comment">/* slab id */</span>
<a name="l00090"></a><a class="code" href="struct____fslab.html#a2c56846b6409122b00ca8864b10ddc26">00090</a>   <a class="code" href="config__global_8h.html#a86dc967583a237dd2bc149d03760364d">sb2</a>           <a class="code" href="struct____fslab.html#a2c56846b6409122b00ca8864b10ddc26">sa</a>;       <span class="comment">/* data row start addr of hslab  sa*psize  sa = ss */</span>   
<a name="l00091"></a><a class="code" href="struct____fslab.html#adabb6550ff779c83cfc5a6fc3d34c090">00091</a>   <span class="keyword">struct </span><a class="code" href="struct____fslab.html">__fslab</a> *<a class="code" href="struct____fslab.html#adabb6550ff779c83cfc5a6fc3d34c090">next</a>;     <span class="comment">/* next */</span>
<a name="l00092"></a>00092 };
<a name="l00093"></a>00093 <span class="keyword">typedef</span>  <span class="keyword">struct </span><a class="code" href="struct____fslab.html">__fslab</a>  FSLAB;
<a name="l00094"></a>00094 
<a name="l00095"></a>00095 <span class="comment">/*</span>
<a name="l00096"></a>00096 <span class="comment">HSLAB  HPOOL[MAX__POOL];</span>
<a name="l00097"></a>00097 <span class="comment">dont del hitem only set drl is 0 </span>
<a name="l00098"></a>00098 <span class="comment">*/</span>
<a name="l00099"></a><a class="code" href="struct____hitem.html">00099</a> <span class="keyword">struct </span><a class="code" href="struct____hitem.html">__hitem</a>
<a name="l00100"></a>00100 {
<a name="l00101"></a><a class="code" href="struct____hitem.html#a8bf5803ab9be56c0516748c9471c5491">00101</a>   <a class="code" href="config__global_8h.html#a5e0e444ca36facaa313c7f26758b6dd0">ub1</a>          *<a class="code" href="struct____hitem.html#a8bf5803ab9be56c0516748c9471c5491">key</a>;      <span class="comment">/* key that is hashed */</span>
<a name="l00102"></a><a class="code" href="struct____hitem.html#a6faa49b419529a988d0029dbbc4a0d2c">00102</a>   <a class="code" href="config__global_8h.html#a3fece3757bfd6deee681fb0d1fd41f97">ub4</a>           <a class="code" href="struct____hitem.html#a6faa49b419529a988d0029dbbc4a0d2c">keyl</a>;     <span class="comment">/* length of key */</span>
<a name="l00103"></a><a class="code" href="struct____hitem.html#a388248cc34d7b35a5a1da6bbbcbd7c85">00103</a>   <a class="code" href="config__global_8h.html#a3fece3757bfd6deee681fb0d1fd41f97">ub4</a>           <a class="code" href="struct____hitem.html#a388248cc34d7b35a5a1da6bbbcbd7c85">drl</a>;      <span class="comment">/* length of data row */</span>
<a name="l00104"></a><a class="code" href="struct____hitem.html#acce5c6a469decf13fff136dddee36012">00104</a>   <a class="code" href="config__global_8h.html#a86dc967583a237dd2bc149d03760364d">sb2</a>           <a class="code" href="struct____hitem.html#acce5c6a469decf13fff136dddee36012">psize</a>;    <span class="comment">/* hpools size */</span>
<a name="l00105"></a><a class="code" href="struct____hitem.html#a933ed6ebfd18421ca0c626a6c3ba8ff0">00105</a>   <a class="code" href="config__global_8h.html#a86dc967583a237dd2bc149d03760364d">sb2</a>           <a class="code" href="struct____hitem.html#a933ed6ebfd18421ca0c626a6c3ba8ff0">sid</a>;      <span class="comment">/* slab id */</span>
<a name="l00106"></a><a class="code" href="struct____hitem.html#a012fe914baa0d8392376fdc317ed9c83">00106</a>   <a class="code" href="config__global_8h.html#a3fece3757bfd6deee681fb0d1fd41f97">ub4</a>           <a class="code" href="struct____hitem.html#a012fe914baa0d8392376fdc317ed9c83">sa</a>;       <span class="comment">/* data row start addr of hslab  sa*psize  sa = ss */</span>
<a name="l00107"></a><a class="code" href="struct____hitem.html#a33dcabe6a1c3c899901e121b75f3ff87">00107</a>   <a class="code" href="config__global_8h.html#a3fece3757bfd6deee681fb0d1fd41f97">ub4</a>           <a class="code" href="struct____hitem.html#a33dcabe6a1c3c899901e121b75f3ff87">hval</a>;     <span class="comment">/* hash value for key */</span>
<a name="l00108"></a><a class="code" href="struct____hitem.html#a82c6d8a5de111f21843581bfa50cc8c5">00108</a>   <a class="code" href="config__global_8h.html#a3fece3757bfd6deee681fb0d1fd41f97">ub4</a>           <a class="code" href="struct____hitem.html#a82c6d8a5de111f21843581bfa50cc8c5">hjval</a>;     <span class="comment">/* hash value for key */</span>
<a name="l00109"></a><a class="code" href="struct____hitem.html#a5085e99e5e6cb16fb57e34fbb74b3af8">00109</a>   <a class="code" href="config__global_8h.html#a3fece3757bfd6deee681fb0d1fd41f97">ub4</a>           <a class="code" href="struct____hitem.html#a5085e99e5e6cb16fb57e34fbb74b3af8">utime</a>;    <span class="comment">/* */</span>
<a name="l00110"></a><a class="code" href="struct____hitem.html#a81134a210aa0c1369f8eba8f783dfddf">00110</a>   <a class="code" href="config__global_8h.html#a3fece3757bfd6deee681fb0d1fd41f97">ub4</a>           <a class="code" href="struct____hitem.html#a81134a210aa0c1369f8eba8f783dfddf">ahit</a>;     <span class="comment">/* all hit */</span>
<a name="l00111"></a><a class="code" href="struct____hitem.html#aa9bfb3e0b2f511aa7d9e71c05ba4d202">00111</a>   <a class="code" href="config__global_8h.html#a3fece3757bfd6deee681fb0d1fd41f97">ub4</a>           <a class="code" href="struct____hitem.html#aa9bfb3e0b2f511aa7d9e71c05ba4d202">amiss</a>;    <span class="comment">/* all update */</span>
<a name="l00112"></a><a class="code" href="struct____hitem.html#aba706155c7f105156da26add273e10b9">00112</a>   <span class="keyword">struct </span><a class="code" href="struct____hitem.html">__hitem</a> *<a class="code" href="struct____hitem.html#aba706155c7f105156da26add273e10b9">next</a>;     <span class="comment">/* next hitem in list */</span>
<a name="l00113"></a>00113 };
<a name="l00114"></a>00114 <span class="keyword">typedef</span>  <span class="keyword">struct </span><a class="code" href="struct____hitem.html">__hitem</a>  HITEM;
<a name="l00115"></a>00115 
<a name="l00116"></a><a class="code" href="struct____hitem__group.html">00116</a> <span class="keyword">struct </span><a class="code" href="struct____hitem__group.html">__hitem_group</a>
<a name="l00117"></a>00117 {
<a name="l00118"></a><a class="code" href="struct____hitem__group.html#a4ad3aab458a2472a4b97f69950a2ec1b">00118</a>     HITEM        **<a class="code" href="struct____hitem__group.html#a4ad3aab458a2472a4b97f69950a2ec1b">usable</a>;
<a name="l00119"></a><a class="code" href="struct____hitem__group.html#a80e6e8bdca84ebc2aebe9a33a6f9f1d0">00119</a>     HITEM        **<a class="code" href="struct____hitem__group.html#a80e6e8bdca84ebc2aebe9a33a6f9f1d0">move</a>;
<a name="l00120"></a><a class="code" href="struct____hitem__group.html#a2423899147b8f56ba772565de8ac755a">00120</a>     <a class="code" href="config__global_8h.html#a3fece3757bfd6deee681fb0d1fd41f97">ub4</a>          <a class="code" href="struct____hitem__group.html#a2423899147b8f56ba772565de8ac755a">bucket</a>;
<a name="l00121"></a>00121 };
<a name="l00122"></a>00122 <span class="keyword">typedef</span>  <span class="keyword">struct </span><a class="code" href="struct____hitem__group.html">__hitem_group</a>  HG;
<a name="l00123"></a>00123 
<a name="l00124"></a>00124 <span class="comment">/* algorithm Recently Used </span>
<a name="l00125"></a>00125 <span class="comment"> * array use this struct </span>
<a name="l00126"></a>00126 <span class="comment"> * if(htab-&gt;step &lt; htab-&gt;logsize) add</span>
<a name="l00127"></a>00127 <span class="comment"> * else{</span>
<a name="l00128"></a>00128 <span class="comment"> *  if(insert ) LRU </span>
<a name="l00129"></a>00129 <span class="comment"> *  if(update) MRU </span>
<a name="l00130"></a>00130 <span class="comment"> * }</span>
<a name="l00131"></a>00131 <span class="comment"> * */</span>
<a name="l00132"></a><a class="code" href="struct____haru.html">00132</a> <span class="keyword">struct </span><a class="code" href="struct____haru.html">__haru</a>
<a name="l00133"></a>00133 {
<a name="l00134"></a><a class="code" href="struct____haru.html#a34e752e8e3086f838752e59dd6917b66">00134</a>   HITEM         *<a class="code" href="struct____haru.html#a34e752e8e3086f838752e59dd6917b66">phitem</a>;  <span class="comment">/* point to hitem */</span>
<a name="l00135"></a><a class="code" href="struct____haru.html#a195ff3dd9c0e4f24303197594566174a">00135</a>   <a class="code" href="config__global_8h.html#a3fece3757bfd6deee681fb0d1fd41f97">ub4</a>           <a class="code" href="struct____haru.html#a195ff3dd9c0e4f24303197594566174a">hit</a>;    <span class="comment">/* haru hit */</span>
<a name="l00136"></a>00136 };
<a name="l00137"></a>00137 <span class="keyword">typedef</span>  <span class="keyword">struct </span><a class="code" href="struct____haru.html">__haru</a>  HARU;
<a name="l00138"></a>00138 
<a name="l00139"></a><a class="code" href="struct____haru__group.html">00139</a> <span class="keyword">struct </span><a class="code" href="struct____haru__group.html">__haru_group</a>
<a name="l00140"></a>00140 {
<a name="l00141"></a><a class="code" href="struct____haru__group.html#aecde464bce2159ea7714264246b78795">00141</a>   HARU <a class="code" href="struct____haru__group.html#aecde464bce2159ea7714264246b78795">haru_pool</a>[<a class="code" href="pool__struct_8h.html#a6c41427e07ce1de3888c2bc77842958d">MAX_HARU_POOL</a>];    <span class="comment">/* haru  */</span>
<a name="l00142"></a><a class="code" href="struct____haru__group.html#a41f75f1fe5b528a15aa0bf686e250918">00142</a>   ssize_t       <a class="code" href="struct____haru__group.html#a41f75f1fe5b528a15aa0bf686e250918">step</a>;
<a name="l00143"></a><a class="code" href="struct____haru__group.html#a4a032d1674eff949e0ab8da0a420aee3">00143</a>   ssize_t       <a class="code" href="struct____haru__group.html#a4a032d1674eff949e0ab8da0a420aee3">max</a>;
<a name="l00144"></a><a class="code" href="struct____haru__group.html#a1a9b2791bac6f598210af0e5a24ad0b7">00144</a>   ssize_t       <a class="code" href="struct____haru__group.html#a1a9b2791bac6f598210af0e5a24ad0b7">mix</a>;
<a name="l00145"></a>00145 };
<a name="l00146"></a>00146 <span class="keyword">typedef</span>  <span class="keyword">struct </span><a class="code" href="struct____haru__group.html">__haru_group</a>  HARUG;
<a name="l00147"></a>00147 
<a name="l00148"></a>00148 <span class="comment">/* for select any proc */</span>
<a name="l00149"></a><a class="code" href="struct____hdr.html">00149</a> <span class="keyword">struct </span><a class="code" href="struct____hdr.html">__hdr</a>
<a name="l00150"></a>00150 {
<a name="l00151"></a><a class="code" href="struct____hdr.html#a8bf5803ab9be56c0516748c9471c5491">00151</a>   <a class="code" href="config__global_8h.html#a5e0e444ca36facaa313c7f26758b6dd0">ub1</a>           *<a class="code" href="struct____hdr.html#a8bf5803ab9be56c0516748c9471c5491">key</a>;     <span class="comment">/* sql that is hashed */</span>
<a name="l00152"></a><a class="code" href="struct____hdr.html#a6faa49b419529a988d0029dbbc4a0d2c">00152</a>   <a class="code" href="config__global_8h.html#a3fece3757bfd6deee681fb0d1fd41f97">ub4</a>           <a class="code" href="struct____hdr.html#a6faa49b419529a988d0029dbbc4a0d2c">keyl</a>;     <span class="comment">/* length of key */</span>
<a name="l00153"></a><a class="code" href="struct____hdr.html#ad15f826f8c53bd8c3cf2a44e6f06359d">00153</a>   <a class="code" href="config__global_8h.html#a3fece3757bfd6deee681fb0d1fd41f97">ub4</a>           <a class="code" href="struct____hdr.html#ad15f826f8c53bd8c3cf2a44e6f06359d">stime</a>;    <span class="comment">/* select time */</span>
<a name="l00154"></a><a class="code" href="struct____hdr.html#adf5e9bea3d59e7418be954248d9a0d53">00154</a>   <a class="code" href="pool__struct_8h.html#ac6c488c4d83e0b8ebc22e427bf653e5f">H_STATE</a>       <a class="code" href="struct____hdr.html#adf5e9bea3d59e7418be954248d9a0d53">flag</a>;     <span class="comment">/* 0 is new, 1 is update, HDR_FALSE worker delete, proc change */</span>
<a name="l00155"></a><a class="code" href="struct____hdr.html#a954ee2406b4b329da0b347793e032a0b">00155</a>   <a class="code" href="config__global_8h.html#a5e0e444ca36facaa313c7f26758b6dd0">ub1</a>           *<a class="code" href="struct____hdr.html#a954ee2406b4b329da0b347793e032a0b">dr</a>;      <span class="comment">/* db return data row */</span>
<a name="l00156"></a><a class="code" href="struct____hdr.html#a388248cc34d7b35a5a1da6bbbcbd7c85">00156</a>   <a class="code" href="config__global_8h.html#a3fece3757bfd6deee681fb0d1fd41f97">ub4</a>           <a class="code" href="struct____hdr.html#a388248cc34d7b35a5a1da6bbbcbd7c85">drl</a>;      <span class="comment">/* length of data row */</span>
<a name="l00157"></a><a class="code" href="struct____hdr.html#a96a66f0a8070a6f243695ca4c122d8a6">00157</a>   <span class="keyword">struct </span><a class="code" href="struct____hdr.html">__hdr</a>   *<a class="code" href="struct____hdr.html#a96a66f0a8070a6f243695ca4c122d8a6">next</a>;  
<a name="l00158"></a>00158 };
<a name="l00159"></a>00159 <span class="keyword">typedef</span>  <span class="keyword">struct </span><a class="code" href="struct____hdr.html">__hdr</a>  HDR;
<a name="l00160"></a>00160 
<a name="l00161"></a>00161 <span class="comment">/* https://github.com/troydhanson/uthash */</span>
<a name="l00162"></a><a class="code" href="struct____htab.html">00162</a> <span class="keyword">struct </span><a class="code" href="struct____htab.html">__htab</a>
<a name="l00163"></a>00163 {
<a name="l00164"></a><a class="code" href="struct____htab.html#a5ae23a026f977a42a542f1e2a8e2cabd">00164</a>   <a class="code" href="config__global_8h.html#aafc9a69535613ac225df2d6195518116">word</a>           <a class="code" href="struct____htab.html#a5ae23a026f977a42a542f1e2a8e2cabd">logsize</a>; <span class="comment">/* log of size of table */</span>
<a name="l00165"></a><a class="code" href="struct____htab.html#a97bfab9f86be5ac6808df0cfde3de97c">00165</a>   <span class="keywordtype">size_t</span>         <a class="code" href="struct____htab.html#a97bfab9f86be5ac6808df0cfde3de97c">mask</a>;    <span class="comment">/* (hashval &amp; mask) is position in table */</span>
<a name="l00166"></a><a class="code" href="struct____htab.html#a10f89a5f251b5175c0e07ccba989dde1">00166</a>   <a class="code" href="config__global_8h.html#a3fece3757bfd6deee681fb0d1fd41f97">ub4</a>            <a class="code" href="struct____htab.html#a10f89a5f251b5175c0e07ccba989dde1">count</a>;   <span class="comment">/* how many items in this hash table so far? 记录目前使用多少hitem_pool */</span>
<a name="l00167"></a><a class="code" href="struct____htab.html#a561ef518d11e2a161f4e89b12f58b597">00167</a>   <a class="code" href="config__global_8h.html#a86dc967583a237dd2bc149d03760364d">sb2</a>            <a class="code" href="struct____htab.html#a561ef518d11e2a161f4e89b12f58b597">bcount</a>;  <span class="comment">/* single items length 记录最长的hitem*/</span>
<a name="l00168"></a><a class="code" href="struct____htab.html#a3dd6e133fa74ed4402058ce2221bc5ff">00168</a>   <a class="code" href="config__global_8h.html#a86dc967583a237dd2bc149d03760364d">sb2</a>            <a class="code" href="struct____htab.html#a3dd6e133fa74ed4402058ce2221bc5ff">lcount</a>;  <span class="comment">/* single items length 记录最短的hitem*/</span>
<a name="l00169"></a><a class="code" href="struct____htab.html#a195ff3dd9c0e4f24303197594566174a">00169</a>   <a class="code" href="config__global_8h.html#a3fece3757bfd6deee681fb0d1fd41f97">ub4</a>            <a class="code" href="struct____htab.html#a195ff3dd9c0e4f24303197594566174a">hit</a>;     <span class="comment">/* hval hit times */</span>
<a name="l00170"></a><a class="code" href="struct____htab.html#a06884c7754d349a6cc6bf14f64304082">00170</a>   <a class="code" href="config__global_8h.html#a3fece3757bfd6deee681fb0d1fd41f97">ub4</a>            <a class="code" href="struct____htab.html#a06884c7754d349a6cc6bf14f64304082">miss</a>;    <span class="comment">/* hval miss times */</span>
<a name="l00171"></a><a class="code" href="struct____htab.html#ab72a0bbe5bbfe64abfd01b30b3f59a21">00171</a>   <a class="code" href="config__global_8h.html#a3fece3757bfd6deee681fb0d1fd41f97">ub4</a>            <span class="keyword">set</span>;     <span class="comment">/* total set */</span>
<a name="l00172"></a><a class="code" href="struct____htab.html#a9b1734f4262c8c072cee394c1c4e6997">00172</a>   <a class="code" href="config__global_8h.html#a3fece3757bfd6deee681fb0d1fd41f97">ub4</a>            <span class="keyword">get</span>;     <span class="comment">/* total get */</span>
<a name="l00173"></a><a class="code" href="struct____htab.html#ad5cb054eaea41545ba0c264ab4fe33f2">00173</a>   <a class="code" href="config__global_8h.html#a3fece3757bfd6deee681fb0d1fd41f97">ub4</a>            <a class="code" href="struct____htab.html#ad5cb054eaea41545ba0c264ab4fe33f2">bytes</a>;    <span class="comment">/* total data size */</span>
<a name="l00174"></a><a class="code" href="struct____htab.html#a4070c4646649bf655432cc3708820775">00174</a>   <a class="code" href="config__global_8h.html#a86dc967583a237dd2bc149d03760364d">sb2</a>            <a class="code" href="struct____htab.html#a4070c4646649bf655432cc3708820775">hslab_stat</a>[<a class="code" href="pool__struct_8h.html#a1106f09f9f2864334a2d6759c334f7c6">MAX_SLAB_CLASS</a>];  <span class="comment">/* hsalb pool length */</span>
<a name="l00175"></a>00175 };
<a name="l00176"></a>00176 <span class="keyword">typedef</span>  <span class="keyword">struct </span><a class="code" href="struct____htab.html">__htab</a>  HTAB;
<a name="l00177"></a>00177 
<a name="l00178"></a><a class="code" href="struct____tlist.html">00178</a> <span class="keyword">struct </span><a class="code" href="struct____tlist.html">__tlist</a>{
<a name="l00179"></a><a class="code" href="struct____tlist.html#a5892a9181e6a332f84d27aecd41dcd12">00179</a>   <span class="keywordtype">char</span>      *<a class="code" href="struct____tlist.html#a5892a9181e6a332f84d27aecd41dcd12">key</a>;  <span class="comment">/* key is table name or ulist  key sql */</span>
<a name="l00180"></a><a class="code" href="struct____tlist.html#a6faa49b419529a988d0029dbbc4a0d2c">00180</a>   <a class="code" href="config__global_8h.html#a3fece3757bfd6deee681fb0d1fd41f97">ub4</a>       <a class="code" href="struct____tlist.html#a6faa49b419529a988d0029dbbc4a0d2c">keyl</a>;      <span class="comment">/* length name */</span>
<a name="l00181"></a><a class="code" href="struct____tlist.html#a5085e99e5e6cb16fb57e34fbb74b3af8">00181</a>   <a class="code" href="config__global_8h.html#a3fece3757bfd6deee681fb0d1fd41f97">ub4</a>       <a class="code" href="struct____tlist.html#a5085e99e5e6cb16fb57e34fbb74b3af8">utime</a>;  <span class="comment">/* table the last update time */</span>
<a name="l00182"></a><a class="code" href="struct____tlist.html#adf5e9bea3d59e7418be954248d9a0d53">00182</a>   <a class="code" href="pool__struct_8h.html#ac6c488c4d83e0b8ebc22e427bf653e5f">H_STATE</a>   <a class="code" href="struct____tlist.html#adf5e9bea3d59e7418be954248d9a0d53">flag</a>;   <span class="comment">/* 1.work set H_TRUE , 2.proc set H_FALSE, 3.work free H_FALSE */</span>
<a name="l00183"></a><a class="code" href="struct____tlist.html#a0dabf30c6d80d5304c1eacc4a930014c">00183</a>   <span class="keyword">struct </span><a class="code" href="struct____tlist.html">__tlist</a> *<a class="code" href="struct____tlist.html#a0dabf30c6d80d5304c1eacc4a930014c">next</a>;  <span class="comment">/* the next table */</span>
<a name="l00184"></a>00184 };
<a name="l00185"></a>00185 <span class="comment">/* mem proc table list */</span>
<a name="l00186"></a>00186 <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="struct____tlist.html">__tlist</a> TLIST;
<a name="l00187"></a>00187 
<a name="l00188"></a>00188 <span class="comment">/* work proc for change table list */</span>
<a name="l00189"></a>00189 <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="struct____tlist.html">__tlist</a> ULIST;
<a name="l00190"></a>00190 
<a name="l00191"></a>00191 <span class="comment">/* slab malloc slot 1M */</span>
<a name="l00192"></a><a class="code" href="struct____hsms.html">00192</a> <span class="keyword">struct </span><a class="code" href="struct____hsms.html">__hsms</a>{
<a name="l00193"></a><a class="code" href="struct____hsms.html#a239012c19138349f5f13e7cec0d4d183">00193</a>   <a class="code" href="config__global_8h.html#a3fece3757bfd6deee681fb0d1fd41f97">ub4</a>       <a class="code" href="struct____hsms.html#a239012c19138349f5f13e7cec0d4d183">size</a>; 
<a name="l00194"></a><a class="code" href="struct____hsms.html#a1518b6f3d032f1196a52ec70c428da14">00194</a>   ssize_t   <a class="code" href="struct____hsms.html#a1518b6f3d032f1196a52ec70c428da14">chunk</a>;   <span class="comment">/* 1.work set 1 , 2.mem set 0, 3.work free 0 */</span>
<a name="l00195"></a>00195 };
<a name="l00196"></a>00196 <span class="comment">/* mem proc table list */</span>
<a name="l00197"></a>00197 <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="struct____hsms.html">__hsms</a> HSMS;
<a name="l00198"></a>00198 
<a name="l00199"></a><a class="code" href="pool__struct_8h.html#acd7fe121a0781b3e5023539d30b804c8">00199</a> HTAB *<a class="code" href="pool__struct_8h.html#acd7fe121a0781b3e5023539d30b804c8">pools_htab</a>;   <span class="comment">/* stat record */</span>
<a name="l00200"></a><a class="code" href="pool__struct_8h.html#ad4d1f21434d7be499b3f3180b66a3fb5">00200</a> <a class="code" href="config__global_8h.html#a3fece3757bfd6deee681fb0d1fd41f97">ub4</a> *<a class="code" href="pool__struct_8h.html#ad4d1f21434d7be499b3f3180b66a3fb5">pools_hitem_row</a>;
<a name="l00201"></a>00201 
<a name="l00202"></a><a class="code" href="pool__struct_8h.html#a14ff278cf7d369006b1da53972f6b25c">00202</a> pthread_mutex_t <a class="code" href="pool__struct_8h.html#a14ff278cf7d369006b1da53972f6b25c">work_lock_hit</a>;
<a name="l00203"></a><a class="code" href="pool__struct_8h.html#aec128b15562eb5ed38c791cb49158515">00203</a> pthread_mutex_t <a class="code" href="pool__struct_8h.html#aec128b15562eb5ed38c791cb49158515">work_lock_miss</a>;
<a name="l00204"></a><a class="code" href="pool__struct_8h.html#a215c0a950549e35acf772e422e76655a">00204</a> pthread_mutex_t <a class="code" href="pool__struct_8h.html#a215c0a950549e35acf772e422e76655a">work_lock_bytes</a>;
<a name="l00205"></a>00205 
<a name="l00206"></a><a class="code" href="pool__struct_8h.html#a845f73040b2316c8a4a92a90e4e167f0">00206</a> HG *<a class="code" href="pool__struct_8h.html#a845f73040b2316c8a4a92a90e4e167f0">hitem_group</a>;
<a name="l00207"></a><a class="code" href="pool__struct_8h.html#adb3bc606d4aab8cd208c99d08023ed0f">00207</a> HITEM **<a class="code" href="pool__struct_8h.html#adb3bc606d4aab8cd208c99d08023ed0f">pools_hitem</a>;
<a name="l00208"></a><a class="code" href="pool__struct_8h.html#a76f5c25dbc3b0bb3d2c6e655015f04fd">00208</a> HDR **<a class="code" href="pool__struct_8h.html#a76f5c25dbc3b0bb3d2c6e655015f04fd">pools_hdr</a>;
<a name="l00209"></a><a class="code" href="pool__struct_8h.html#a48a517c9b5b6516d0ba81bfb0d02b856">00209</a> TLIST *<a class="code" href="pool__struct_8h.html#a48a517c9b5b6516d0ba81bfb0d02b856">pools_tlist</a>;
<a name="l00210"></a><a class="code" href="pool__struct_8h.html#afc9aa409b9da2218e88b4ce34056857c">00210</a> ULIST **<a class="code" href="pool__struct_8h.html#afc9aa409b9da2218e88b4ce34056857c">pools_ulist</a>;
<a name="l00211"></a><a class="code" href="pool__struct_8h.html#ad416e8db1d8e58823359c4b2ebe44e08">00211</a> HSLAB **<a class="code" href="pool__struct_8h.html#ad416e8db1d8e58823359c4b2ebe44e08">pools_hslab</a>;
<a name="l00212"></a>00212 
<a name="l00213"></a><a class="code" href="pool__struct_8h.html#aaf77e22bb5acbada7e78e2e947aab433">00213</a> pthread_mutex_t <a class="code" href="pool__struct_8h.html#aaf77e22bb5acbada7e78e2e947aab433">work_lock_fslab</a>;
<a name="l00214"></a><a class="code" href="pool__struct_8h.html#aadf7ecfd12fcc142a18ed48553261a6e">00214</a> FSLAB *<a class="code" href="pool__struct_8h.html#aadf7ecfd12fcc142a18ed48553261a6e">pools_fslab</a>;
<a name="l00215"></a>00215 
<a name="l00216"></a><a class="code" href="pool__struct_8h.html#ac7a71337a56d3fb4bd27aceed22f38e3">00216</a> HSMS <a class="code" href="pool__struct_8h.html#ac7a71337a56d3fb4bd27aceed22f38e3">slabclass</a>[<a class="code" href="pool__struct_8h.html#a1106f09f9f2864334a2d6759c334f7c6">MAX_SLAB_CLASS</a>];
<a name="l00217"></a>00217 
<a name="l00218"></a><a class="code" href="pool__struct_8h.html#a1e541bc0d8108f75b97a38772eb40f0c">00218</a> HARUG *<a class="code" href="pool__struct_8h.html#a1e541bc0d8108f75b97a38772eb40f0c">pools_harug</a>;
<a name="l00219"></a><a class="code" href="pool__struct_8h.html#a9fe5d5af7b49d4fe56cb111aa1a2dfd4">00219</a> HARU *<a class="code" href="pool__struct_8h.html#a9fe5d5af7b49d4fe56cb111aa1a2dfd4">pools_haru_pool</a>;
<a name="l00220"></a>00220 
<a name="l00221"></a><a class="code" href="pool__struct_8h.html#ab6f9f35ea5c171951e77ad7eb1ffbb64">00221</a> <span class="preprocessor">#define HIT_LOCK() do{\</span>
<a name="l00222"></a>00222 <span class="preprocessor">    pthread_mutex_lock(&amp;work_lock_hit); \</span>
<a name="l00223"></a>00223 <span class="preprocessor">}while(0)</span>
<a name="l00224"></a>00224 <span class="preprocessor"></span>
<a name="l00225"></a><a class="code" href="pool__struct_8h.html#a3884b3278fe59c7d7a72a12c77b60f4e">00225</a> <span class="preprocessor">#define HIT_UNLOCK() do{\</span>
<a name="l00226"></a>00226 <span class="preprocessor">    pthread_mutex_unlock(&amp;work_lock_hit); \</span>
<a name="l00227"></a>00227 <span class="preprocessor">}while(0)</span>
<a name="l00228"></a>00228 <span class="preprocessor"></span>
<a name="l00229"></a><a class="code" href="pool__struct_8h.html#ac0c654917f093dafe95db4f778c27d19">00229</a> <span class="preprocessor">#define MISS_LOCK() do{\</span>
<a name="l00230"></a>00230 <span class="preprocessor">    pthread_mutex_lock(&amp;work_lock_miss); \</span>
<a name="l00231"></a>00231 <span class="preprocessor">}while(0)</span>
<a name="l00232"></a>00232 <span class="preprocessor"></span>
<a name="l00233"></a><a class="code" href="pool__struct_8h.html#a197491f71c85796b857d00f0d8c37df3">00233</a> <span class="preprocessor">#define MISS_UNLOCK() do{\</span>
<a name="l00234"></a>00234 <span class="preprocessor">    pthread_mutex_unlock(&amp;work_lock_miss); \</span>
<a name="l00235"></a>00235 <span class="preprocessor">}while(0)</span>
<a name="l00236"></a>00236 <span class="preprocessor"></span>
<a name="l00237"></a><a class="code" href="pool__struct_8h.html#ae9fefd65d778de1a47a8ba27a17063fe">00237</a> <span class="preprocessor">#define BYTES_LOCK() do{\</span>
<a name="l00238"></a>00238 <span class="preprocessor">    pthread_mutex_lock(&amp;work_lock_bytes); \</span>
<a name="l00239"></a>00239 <span class="preprocessor">}while(0)</span>
<a name="l00240"></a>00240 <span class="preprocessor"></span>
<a name="l00241"></a><a class="code" href="pool__struct_8h.html#a1befd39f27aec856fcac8f68a2c77caf">00241</a> <span class="preprocessor">#define BYTES_UNLOCK() do{\</span>
<a name="l00242"></a>00242 <span class="preprocessor">    pthread_mutex_unlock(&amp;work_lock_bytes); \</span>
<a name="l00243"></a>00243 <span class="preprocessor">}while(0)</span>
<a name="l00244"></a>00244 <span class="preprocessor"></span>
<a name="l00245"></a><a class="code" href="pool__struct_8h.html#a97c87a193bfb63bff0a34f64aa486b87">00245</a> <span class="preprocessor">#define HITEM_SWITCH(y) do{\</span>
<a name="l00246"></a>00246 <span class="preprocessor">    if(hitem_group-&gt;bucket &lt; (y)){            \</span>
<a name="l00247"></a>00247 <span class="preprocessor">        pools_hitem = hitem_group-&gt;move; \</span>
<a name="l00248"></a>00248 <span class="preprocessor">    }else                               \</span>
<a name="l00249"></a>00249 <span class="preprocessor">        pools_hitem = hitem_group-&gt;usable; \</span>
<a name="l00250"></a>00250 <span class="preprocessor">}while(0)</span>
<a name="l00251"></a>00251 <span class="preprocessor"></span>
<a name="l00252"></a>00252 <span class="preprocessor">#ifdef __cplusplus</span>
<a name="l00253"></a>00253 <span class="preprocessor"></span> }
<a name="l00254"></a>00254 <span class="preprocessor">#endif</span>
<a name="l00255"></a>00255 <span class="preprocessor"></span><span class="preprocessor">#endif </span><span class="comment">/* --- #POOL_STRUCT_H ---*/</span>
<a name="l00256"></a>00256  <span class="comment">/* vim: set ts=4 sw=4: */</span>
<a name="l00257"></a>00257 
</pre></div></div>
<hr size="1"/><address style="text-align: right;"><small>Generated on 23 Dec 2013 for fdbc by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
